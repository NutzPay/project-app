"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/xgate/usdt/create/route";
exports.ids = ["app/api/xgate/usdt/create/route"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "(rsc)/../../node_modules/.pnpm/next@14.2.3_react-dom@18.2.0_react@18.2.0__react@18.2.0_sass@1.92.1/node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fxgate%2Fusdt%2Fcreate%2Froute&page=%2Fapi%2Fxgate%2Fusdt%2Fcreate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fxgate%2Fusdt%2Fcreate%2Froute.ts&appDir=%2FUsers%2Ffelixelmada%2FDesktop%2Fnutz-current-20250909-195539%2Fapps%2Fweb%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Ffelixelmada%2FDesktop%2Fnutz-current-20250909-195539%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ../../node_modules/.pnpm/next@14.2.3_react-dom@18.2.0_react@18.2.0__react@18.2.0_sass@1.92.1/node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fxgate%2Fusdt%2Fcreate%2Froute&page=%2Fapi%2Fxgate%2Fusdt%2Fcreate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fxgate%2Fusdt%2Fcreate%2Froute.ts&appDir=%2FUsers%2Ffelixelmada%2FDesktop%2Fnutz-current-20250909-195539%2Fapps%2Fweb%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Ffelixelmada%2FDesktop%2Fnutz-current-20250909-195539%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/../../node_modules/.pnpm/next@14.2.3_react-dom@18.2.0_react@18.2.0__react@18.2.0_sass@1.92.1/node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/../../node_modules/.pnpm/next@14.2.3_react-dom@18.2.0_react@18.2.0__react@18.2.0_sass@1.92.1/node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/../../node_modules/.pnpm/next@14.2.3_react-dom@18.2.0_react@18.2.0__react@18.2.0_sass@1.92.1/node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_felixelmada_Desktop_nutz_current_20250909_195539_apps_web_src_app_api_xgate_usdt_create_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/xgate/usdt/create/route.ts */ \"(rsc)/./src/app/api/xgate/usdt/create/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/xgate/usdt/create/route\",\n        pathname: \"/api/xgate/usdt/create\",\n        filename: \"route\",\n        bundlePath: \"app/api/xgate/usdt/create/route\"\n    },\n    resolvedPagePath: \"/Users/felixelmada/Desktop/nutz-current-20250909-195539/apps/web/src/app/api/xgate/usdt/create/route.ts\",\n    nextConfigOutput,\n    userland: _Users_felixelmada_Desktop_nutz_current_20250909_195539_apps_web_src_app_api_xgate_usdt_create_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/xgate/usdt/create/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL25leHRAMTQuMi4zX3JlYWN0LWRvbUAxOC4yLjBfcmVhY3RAMTguMi4wX19yZWFjdEAxOC4yLjBfc2Fzc0AxLjkyLjEvbm9kZV9tb2R1bGVzL25leHQvZGlzdC9idWlsZC93ZWJwYWNrL2xvYWRlcnMvbmV4dC1hcHAtbG9hZGVyLmpzP25hbWU9YXBwJTJGYXBpJTJGeGdhdGUlMkZ1c2R0JTJGY3JlYXRlJTJGcm91dGUmcGFnZT0lMkZhcGklMkZ4Z2F0ZSUyRnVzZHQlMkZjcmVhdGUlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZ4Z2F0ZSUyRnVzZHQlMkZjcmVhdGUlMkZyb3V0ZS50cyZhcHBEaXI9JTJGVXNlcnMlMkZmZWxpeGVsbWFkYSUyRkRlc2t0b3AlMkZudXR6LWN1cnJlbnQtMjAyNTA5MDktMTk1NTM5JTJGYXBwcyUyRndlYiUyRnNyYyUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZmZWxpeGVsbWFkYSUyRkRlc2t0b3AlMkZudXR6LWN1cnJlbnQtMjAyNTA5MDktMTk1NTM5JTJGYXBwcyUyRndlYiZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDdUQ7QUFDcEk7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AbnV0emJldGEvd2ViLz83NjFjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9mZWxpeGVsbWFkYS9EZXNrdG9wL251dHotY3VycmVudC0yMDI1MDkwOS0xOTU1MzkvYXBwcy93ZWIvc3JjL2FwcC9hcGkveGdhdGUvdXNkdC9jcmVhdGUvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3hnYXRlL3VzZHQvY3JlYXRlL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkveGdhdGUvdXNkdC9jcmVhdGVcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3hnYXRlL3VzZHQvY3JlYXRlL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL2ZlbGl4ZWxtYWRhL0Rlc2t0b3AvbnV0ei1jdXJyZW50LTIwMjUwOTA5LTE5NTUzOS9hcHBzL3dlYi9zcmMvYXBwL2FwaS94Z2F0ZS91c2R0L2NyZWF0ZS9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkveGdhdGUvdXNkdC9jcmVhdGUvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/.pnpm/next@14.2.3_react-dom@18.2.0_react@18.2.0__react@18.2.0_sass@1.92.1/node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fxgate%2Fusdt%2Fcreate%2Froute&page=%2Fapi%2Fxgate%2Fusdt%2Fcreate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fxgate%2Fusdt%2Fcreate%2Froute.ts&appDir=%2FUsers%2Ffelixelmada%2FDesktop%2Fnutz-current-20250909-195539%2Fapps%2Fweb%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Ffelixelmada%2FDesktop%2Fnutz-current-20250909-195539%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/xgate/usdt/create/route.ts":
/*!************************************************!*\
  !*** ./src/app/api/xgate/usdt/create/route.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/.pnpm/next@14.2.3_react-dom@18.2.0_react@18.2.0__react@18.2.0_sass@1.92.1/node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_xgate__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/xgate */ \"(rsc)/./src/lib/xgate.ts\");\n/* harmony import */ var _lib_walletService__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/walletService */ \"(rsc)/./src/lib/walletService.ts\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./src/lib/auth.ts\");\n/* harmony import */ var _lib_priceCalculator__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/priceCalculator */ \"(rsc)/./src/lib/priceCalculator.ts\");\n\n\n\n\n\nasync function POST(request) {\n    try {\n        // Verificar autenticação do usuário\n        const currentUser = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_3__.getCurrentUser)(request);\n        if (!currentUser) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Usu\\xe1rio n\\xe3o autenticado\",\n                code: \"UNAUTHORIZED\"\n            }, {\n                status: 401\n            });\n        }\n        const { amount, usdtAmount, name, taxId, description, externalId } = await request.json();\n        // Validate input\n        if (!amount || !name || !taxId || !description) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Campos obrigat\\xf3rios: amount, name, taxId, description\",\n                code: \"VALIDATION_ERROR\"\n            }, {\n                status: 400\n            });\n        }\n        if (amount < 1) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Valor m\\xednimo para compra de USDT \\xe9 R$ 1,00\",\n                code: \"VALIDATION_ERROR\"\n            }, {\n                status: 400\n            });\n        }\n        console.log(\"\\uD83C\\uDFE6 Creating real USDT purchase via XGate...\");\n        console.log(\"\\uD83D\\uDCCB Data:\", {\n            amount: `R$ ${amount}`,\n            usdtAmount: usdtAmount ? `${usdtAmount} USDT` : \"TBD\",\n            name,\n            taxId: `${taxId.substring(0, 3)}***`,\n            description\n        });\n        try {\n            const xgateService = (0,_lib_xgate__WEBPACK_IMPORTED_MODULE_1__.getXGateService)();\n            // Initialize XGate service (load currencies/cryptos)\n            console.log(\"\\uD83D\\uDD27 Initializing XGate service...\");\n            const initialized = await xgateService.loadCurrenciesAndCryptos();\n            if (!initialized) {\n                throw new Error(\"Failed to initialize XGate service - currencies/cryptos not loaded\");\n            }\n            // Get BRL currency and USDT crypto IDs\n            const brlCurrency = xgateService.getBRLCurrency();\n            const usdtCrypto = xgateService.getUSDTCrypto();\n            if (!brlCurrency) {\n                throw new Error(\"BRL/PIX currency not available on XGate\");\n            }\n            if (!usdtCrypto) {\n                throw new Error(\"USDT cryptocurrency not available on XGate\");\n            }\n            console.log(\"\\uD83D\\uDCB0 Found currencies:\", {\n                brl: `${brlCurrency.name} (${brlCurrency._id || brlCurrency.id})`,\n                usdt: `${usdtCrypto.name} (${usdtCrypto._id || usdtCrypto.id})`\n            });\n            // Try to get quote for BRL → USDT conversion (optional for some accounts)\n            console.log(\"\\uD83D\\uDCB1 Attempting to get conversion quote...\");\n            const quote = await xgateService.getQuote(amount);\n            // Usar nova calculadora de preços com CoinMarketCap + taxa do seller\n            console.log(\"\\uD83D\\uDCB0 Using new price calculator with CoinMarketCap data...\");\n            const priceCalculation = await _lib_priceCalculator__WEBPACK_IMPORTED_MODULE_4__.priceCalculator.calculateUSDTAmount(amount, currentUser.id);\n            console.log(\"\\uD83D\\uDCB1 Price calculation result:\", {\n                userId: currentUser.id,\n                brlAmount: amount,\n                usdtAmount: priceCalculation.usdtAmount,\n                usdtPrice: priceCalculation.usdtPrice,\n                sellerFee: priceCalculation.sellerFee,\n                pricePerUsdt: priceCalculation.pricePerUsdt\n            });\n            const calculatedUsdtAmount = priceCalculation.usdtAmount;\n            const exchangeRate = 1 / priceCalculation.pricePerUsdt; // Converter para formato compatível\n            if (quote.success && quote.data) {\n                console.log(\"✅ XGate Quote received (informational only):\", {\n                    from: `R$ ${quote.data.fromAmount}`,\n                    to: `${quote.data.toAmount} USDT`,\n                    rate: quote.data.rate,\n                    note: \"Using CoinMarketCap + seller fee instead\"\n                });\n            } else {\n                console.log(\"ℹ️ XGate quote not available, using CoinMarketCap + seller fee\");\n            }\n            // Create or get customer\n            console.log(\"\\uD83D\\uDC64 Creating/getting customer...\");\n            const customerId = await xgateService.createOrGetCustomer(name, `customer_${Date.now()}@nutzbeta.temp`, taxId.replace(/\\D/g, \"\"));\n            if (!customerId) {\n                throw new Error(\"Failed to create/get customer on XGate\");\n            }\n            console.log(\"✅ Customer ID:\", customerId);\n            // Create deposit order\n            console.log(\"\\uD83D\\uDCB3 Creating deposit order...\");\n            const depositResult = await xgateService.createDeposit({\n                customerId: customerId,\n                currencyId: brlCurrency._id,\n                cryptoId: usdtCrypto._id,\n                amount: amount,\n                description: description,\n                webhookUrl: process.env.XGATE_WEBHOOK_URL || \"https://2b8d13184f99.ngrok.app/api/xgate/webhook\"\n            });\n            if (!depositResult.success || !depositResult.data) {\n                throw new Error(`Deposit creation failed: ${depositResult.error}`);\n            }\n            console.log(\"✅ Deposit created:\", depositResult.data.id);\n            // Create pending transaction in database\n            try {\n                // Using authenticated user ID\n                const userId = currentUser.id;\n                await _lib_walletService__WEBPACK_IMPORTED_MODULE_2__.walletService.createPendingTransaction({\n                    userId: userId,\n                    type: \"DEPOSIT\",\n                    amount: calculatedUsdtAmount,\n                    pixCode: depositResult.data.pixCode,\n                    pixTransactionId: depositResult.data.id,\n                    brlAmount: amount,\n                    exchangeRate: exchangeRate,\n                    description: description,\n                    externalId: depositResult.data.id\n                });\n                console.log(\"✅ Pending transaction created in database:\", {\n                    userId: currentUser.id,\n                    userEmail: currentUser.email,\n                    pixTransactionId: depositResult.data.id,\n                    usdtAmount: calculatedUsdtAmount\n                });\n            } catch (dbError) {\n                console.error(\"⚠️ Failed to create pending transaction in database:\", dbError);\n            // Continue anyway - the webhook can still process the payment\n            }\n            // Generate QR Code URL if not provided\n            let qrCodeUrl = depositResult.data.qrCodeUrl;\n            if (!qrCodeUrl && depositResult.data.pixCode) {\n                qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=256x256&data=${encodeURIComponent(depositResult.data.pixCode)}`;\n            }\n            // Return standardized response\n            const response = {\n                success: true,\n                pixCode: depositResult.data.pixCode,\n                transactionId: depositResult.data.id,\n                status: depositResult.data.status,\n                amount: depositResult.data.amount,\n                usdtAmount: depositResult.data.cryptoAmount,\n                expiresAt: depositResult.data.expiresAt,\n                qrCodeUrl: qrCodeUrl,\n                // Legacy fields for compatibility\n                id: depositResult.data.id,\n                qrCodeText: depositResult.data.pixCode,\n                exchangeRate: exchangeRate,\n                createdAt: new Date().toISOString(),\n                type: \"usdt_purchase\",\n                provider: \"xgate\"\n            };\n            console.log(\"\\uD83C\\uDF89 USDT order created successfully!\");\n            console.log(\"\\uD83D\\uDCCA Final response:\", {\n                id: response.id,\n                amount: `R$ ${response.amount}`,\n                usdt: `${response.usdtAmount} USDT`,\n                status: response.status\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(response);\n        } catch (xgateError) {\n            console.error(\"❌ XGate integration error:\", xgateError);\n            const errorMessage = xgateError.message;\n            let errorCode = \"XGATE_ERROR\";\n            if (errorMessage.includes(\"Authentication\") || errorMessage.includes(\"credentials\")) {\n                errorCode = \"AUTH_ERROR\";\n            } else if (errorMessage.includes(\"not available\") || errorMessage.includes(\"not found\")) {\n                errorCode = \"VALIDATION_ERROR\";\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: `XGate error: ${errorMessage}`,\n                code: errorCode\n            }, {\n                status: 500\n            });\n        }\n    } catch (error) {\n        console.error(\"❌ Error creating USDT order:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: \"Erro interno ao criar ordem USDT\",\n            code: \"INTERNAL_ERROR\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS94Z2F0ZS91c2R0L2NyZWF0ZS9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBd0Q7QUFDVjtBQUNNO0FBQ1I7QUFFWTtBQUVqRCxlQUFlSyxLQUFLQyxPQUFvQjtJQUM3QyxJQUFJO1FBQ0Ysb0NBQW9DO1FBQ3BDLE1BQU1DLGNBQWMsTUFBTUoseURBQWNBLENBQUNHO1FBRXpDLElBQUksQ0FBQ0MsYUFBYTtZQUNoQixPQUFPUCxxREFBWUEsQ0FBQ1EsSUFBSSxDQUN0QjtnQkFDRUMsU0FBUztnQkFDVEMsT0FBTztnQkFDUEMsTUFBTTtZQUNSLEdBQ0E7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLE1BQU0sRUFBRUMsTUFBTSxFQUFFQyxVQUFVLEVBQUVDLElBQUksRUFBRUMsS0FBSyxFQUFFQyxXQUFXLEVBQUVDLFVBQVUsRUFBRSxHQUFHLE1BQU1aLFFBQVFFLElBQUk7UUFFdkYsaUJBQWlCO1FBQ2pCLElBQUksQ0FBQ0ssVUFBVSxDQUFDRSxRQUFRLENBQUNDLFNBQVMsQ0FBQ0MsYUFBYTtZQUM5QyxPQUFPakIscURBQVlBLENBQUNRLElBQUksQ0FDdEI7Z0JBQ0VDLFNBQVM7Z0JBQ1RDLE9BQU87Z0JBQ1BDLE1BQU07WUFDUixHQUNBO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSxJQUFJQyxTQUFTLEdBQUc7WUFDZCxPQUFPYixxREFBWUEsQ0FBQ1EsSUFBSSxDQUN0QjtnQkFDRUMsU0FBUztnQkFDVEMsT0FBTztnQkFDUEMsTUFBTTtZQUNSLEdBQ0E7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBTyxRQUFRQyxHQUFHLENBQUM7UUFDWkQsUUFBUUMsR0FBRyxDQUFDLHNCQUFZO1lBQ3RCUCxRQUFRLENBQUMsR0FBRyxFQUFFQSxPQUFPLENBQUM7WUFDdEJDLFlBQVlBLGFBQWEsQ0FBQyxFQUFFQSxXQUFXLEtBQUssQ0FBQyxHQUFHO1lBQ2hEQztZQUNBQyxPQUFPLENBQUMsRUFBRUEsTUFBTUss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YUcsUUFBUSxDQUFDLG9CQUFvQkgsYUFBYUcsUUFBUSxDQUFDLGNBQWM7Z0JBQ3ZGRCxZQUFZO1lBQ2Q7WUFFQSxPQUFPckYscURBQVlBLENBQUNRLElBQUksQ0FDdEI7Z0JBQ0VDLFNBQVM7Z0JBQ1RDLE9BQU8sQ0FBQyxhQUFhLEVBQUV5RSxhQUFhLENBQUM7Z0JBQ3JDeEUsTUFBTTBFO1lBQ1IsR0FDQTtnQkFBRXpFLFFBQVE7WUFBSTtRQUVsQjtJQUVGLEVBQUUsT0FBT0YsT0FBTztRQUNkUyxRQUFRVCxLQUFLLENBQUMsZ0NBQWdDQTtRQUM5QyxPQUFPVixxREFBWUEsQ0FBQ1EsSUFBSSxDQUN0QjtZQUNFQyxTQUFTO1lBQ1RDLE9BQU87WUFDUEMsTUFBTTtRQUNSLEdBQ0E7WUFBRUMsUUFBUTtRQUFJO0lBRWxCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AbnV0emJldGEvd2ViLy4vc3JjL2FwcC9hcGkveGdhdGUvdXNkdC9jcmVhdGUvcm91dGUudHM/NGU2OCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgZ2V0WEdhdGVTZXJ2aWNlIH0gZnJvbSAnQC9saWIveGdhdGUnO1xuaW1wb3J0IHsgd2FsbGV0U2VydmljZSB9IGZyb20gJ0AvbGliL3dhbGxldFNlcnZpY2UnO1xuaW1wb3J0IHsgZ2V0Q3VycmVudFVzZXIgfSBmcm9tICdAL2xpYi9hdXRoJztcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJ0AvbGliL3ByaXNtYSc7XG5pbXBvcnQgeyBwcmljZUNhbGN1bGF0b3IgfSBmcm9tICdAL2xpYi9wcmljZUNhbGN1bGF0b3InO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICB0cnkge1xuICAgIC8vIFZlcmlmaWNhciBhdXRlbnRpY2HDp8OjbyBkbyB1c3XDoXJpb1xuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gYXdhaXQgZ2V0Q3VycmVudFVzZXIocmVxdWVzdCk7XG4gICAgXG4gICAgaWYgKCFjdXJyZW50VXNlcikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IFxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiAnVXN1w6FyaW8gbsOjbyBhdXRlbnRpY2FkbycsXG4gICAgICAgICAgY29kZTogJ1VOQVVUSE9SSVpFRCdcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHsgYW1vdW50LCB1c2R0QW1vdW50LCBuYW1lLCB0YXhJZCwgZGVzY3JpcHRpb24sIGV4dGVybmFsSWQgfSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xuXG4gICAgLy8gVmFsaWRhdGUgaW5wdXRcbiAgICBpZiAoIWFtb3VudCB8fCAhbmFtZSB8fCAhdGF4SWQgfHwgIWRlc2NyaXB0aW9uKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdDYW1wb3Mgb2JyaWdhdMOzcmlvczogYW1vdW50LCBuYW1lLCB0YXhJZCwgZGVzY3JpcHRpb24nLFxuICAgICAgICAgIGNvZGU6ICdWQUxJREFUSU9OX0VSUk9SJ1xuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKGFtb3VudCA8IDEpIHsgLy8gTWluaW11bSBSJDEgQlJMXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdWYWxvciBtw61uaW1vIHBhcmEgY29tcHJhIGRlIFVTRFQgw6kgUiQgMSwwMCcsXG4gICAgICAgICAgY29kZTogJ1ZBTElEQVRJT05fRVJST1InXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygn8J+PpiBDcmVhdGluZyByZWFsIFVTRFQgcHVyY2hhc2UgdmlhIFhHYXRlLi4uJyk7XG4gICAgY29uc29sZS5sb2coJ/Cfk4sgRGF0YTonLCB7IFxuICAgICAgYW1vdW50OiBgUiQgJHthbW91bnR9YCxcbiAgICAgIHVzZHRBbW91bnQ6IHVzZHRBbW91bnQgPyBgJHt1c2R0QW1vdW50fSBVU0RUYCA6ICdUQkQnLFxuICAgICAgbmFtZSxcbiAgICAgIHRheElkOiBgJHt0YXhJZC5zdWJzdHJpbmcoMCwgMyl9KioqYCxcbiAgICAgIGRlc2NyaXB0aW9uXG4gICAgfSk7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgeGdhdGVTZXJ2aWNlID0gZ2V0WEdhdGVTZXJ2aWNlKCk7XG4gICAgICBcbiAgICAgIC8vIEluaXRpYWxpemUgWEdhdGUgc2VydmljZSAobG9hZCBjdXJyZW5jaWVzL2NyeXB0b3MpXG4gICAgICBjb25zb2xlLmxvZygn8J+UpyBJbml0aWFsaXppbmcgWEdhdGUgc2VydmljZS4uLicpO1xuICAgICAgY29uc3QgaW5pdGlhbGl6ZWQgPSBhd2FpdCB4Z2F0ZVNlcnZpY2UubG9hZEN1cnJlbmNpZXNBbmRDcnlwdG9zKCk7XG4gICAgICBcbiAgICAgIGlmICghaW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBYR2F0ZSBzZXJ2aWNlIC0gY3VycmVuY2llcy9jcnlwdG9zIG5vdCBsb2FkZWQnKTtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IEJSTCBjdXJyZW5jeSBhbmQgVVNEVCBjcnlwdG8gSURzXG4gICAgICBjb25zdCBicmxDdXJyZW5jeSA9IHhnYXRlU2VydmljZS5nZXRCUkxDdXJyZW5jeSgpO1xuICAgICAgY29uc3QgdXNkdENyeXB0byA9IHhnYXRlU2VydmljZS5nZXRVU0RUQ3J5cHRvKCk7XG5cbiAgICAgIGlmICghYnJsQ3VycmVuY3kpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdCUkwvUElYIGN1cnJlbmN5IG5vdCBhdmFpbGFibGUgb24gWEdhdGUnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCF1c2R0Q3J5cHRvKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVVNEVCBjcnlwdG9jdXJyZW5jeSBub3QgYXZhaWxhYmxlIG9uIFhHYXRlJyk7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKCfwn5KwIEZvdW5kIGN1cnJlbmNpZXM6Jywge1xuICAgICAgICBicmw6IGAke2JybEN1cnJlbmN5Lm5hbWV9ICgke2JybEN1cnJlbmN5Ll9pZCB8fCBicmxDdXJyZW5jeS5pZH0pYCxcbiAgICAgICAgdXNkdDogYCR7dXNkdENyeXB0by5uYW1lfSAoJHt1c2R0Q3J5cHRvLl9pZCB8fCB1c2R0Q3J5cHRvLmlkfSlgXG4gICAgICB9KTtcblxuICAgICAgLy8gVHJ5IHRvIGdldCBxdW90ZSBmb3IgQlJMIOKGkiBVU0RUIGNvbnZlcnNpb24gKG9wdGlvbmFsIGZvciBzb21lIGFjY291bnRzKVxuICAgICAgY29uc29sZS5sb2coJ/CfkrEgQXR0ZW1wdGluZyB0byBnZXQgY29udmVyc2lvbiBxdW90ZS4uLicpO1xuICAgICAgY29uc3QgcXVvdGUgPSBhd2FpdCB4Z2F0ZVNlcnZpY2UuZ2V0UXVvdGUoYW1vdW50KTtcbiAgICAgIFxuICAgICAgLy8gVXNhciBub3ZhIGNhbGN1bGFkb3JhIGRlIHByZcOnb3MgY29tIENvaW5NYXJrZXRDYXAgKyB0YXhhIGRvIHNlbGxlclxuICAgICAgY29uc29sZS5sb2coJ/CfkrAgVXNpbmcgbmV3IHByaWNlIGNhbGN1bGF0b3Igd2l0aCBDb2luTWFya2V0Q2FwIGRhdGEuLi4nKTtcbiAgICAgIGNvbnN0IHByaWNlQ2FsY3VsYXRpb24gPSBhd2FpdCBwcmljZUNhbGN1bGF0b3IuY2FsY3VsYXRlVVNEVEFtb3VudChhbW91bnQsIGN1cnJlbnRVc2VyLmlkKTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ/CfkrEgUHJpY2UgY2FsY3VsYXRpb24gcmVzdWx0OicsIHtcbiAgICAgICAgdXNlcklkOiBjdXJyZW50VXNlci5pZCxcbiAgICAgICAgYnJsQW1vdW50OiBhbW91bnQsXG4gICAgICAgIHVzZHRBbW91bnQ6IHByaWNlQ2FsY3VsYXRpb24udXNkdEFtb3VudCxcbiAgICAgICAgdXNkdFByaWNlOiBwcmljZUNhbGN1bGF0aW9uLnVzZHRQcmljZSxcbiAgICAgICAgc2VsbGVyRmVlOiBwcmljZUNhbGN1bGF0aW9uLnNlbGxlckZlZSxcbiAgICAgICAgcHJpY2VQZXJVc2R0OiBwcmljZUNhbGN1bGF0aW9uLnByaWNlUGVyVXNkdFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGNhbGN1bGF0ZWRVc2R0QW1vdW50ID0gcHJpY2VDYWxjdWxhdGlvbi51c2R0QW1vdW50O1xuICAgICAgY29uc3QgZXhjaGFuZ2VSYXRlID0gMSAvIHByaWNlQ2FsY3VsYXRpb24ucHJpY2VQZXJVc2R0OyAvLyBDb252ZXJ0ZXIgcGFyYSBmb3JtYXRvIGNvbXBhdMOtdmVsXG4gICAgICBcbiAgICAgIGlmIChxdW90ZS5zdWNjZXNzICYmIHF1b3RlLmRhdGEpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ+KchSBYR2F0ZSBRdW90ZSByZWNlaXZlZCAoaW5mb3JtYXRpb25hbCBvbmx5KTonLCB7XG4gICAgICAgICAgZnJvbTogYFIkICR7cXVvdGUuZGF0YS5mcm9tQW1vdW50fWAsXG4gICAgICAgICAgdG86IGAke3F1b3RlLmRhdGEudG9BbW91bnR9IFVTRFRgLFxuICAgICAgICAgIHJhdGU6IHF1b3RlLmRhdGEucmF0ZSxcbiAgICAgICAgICBub3RlOiAnVXNpbmcgQ29pbk1hcmtldENhcCArIHNlbGxlciBmZWUgaW5zdGVhZCdcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZygn4oS577iPIFhHYXRlIHF1b3RlIG5vdCBhdmFpbGFibGUsIHVzaW5nIENvaW5NYXJrZXRDYXAgKyBzZWxsZXIgZmVlJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIENyZWF0ZSBvciBnZXQgY3VzdG9tZXJcbiAgICAgIGNvbnNvbGUubG9nKCfwn5GkIENyZWF0aW5nL2dldHRpbmcgY3VzdG9tZXIuLi4nKTtcbiAgICAgIGNvbnN0IGN1c3RvbWVySWQgPSBhd2FpdCB4Z2F0ZVNlcnZpY2UuY3JlYXRlT3JHZXRDdXN0b21lcihcbiAgICAgICAgbmFtZSxcbiAgICAgICAgYGN1c3RvbWVyXyR7RGF0ZS5ub3coKX1AbnV0emJldGEudGVtcGAsIC8vIFRlbXAgZW1haWwgZm9yIG5vd1xuICAgICAgICB0YXhJZC5yZXBsYWNlKC9cXEQvZywgJycpXG4gICAgICApO1xuXG4gICAgICBpZiAoIWN1c3RvbWVySWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gY3JlYXRlL2dldCBjdXN0b21lciBvbiBYR2F0ZScpO1xuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZygn4pyFIEN1c3RvbWVyIElEOicsIGN1c3RvbWVySWQpO1xuXG4gICAgICAvLyBDcmVhdGUgZGVwb3NpdCBvcmRlclxuICAgICAgY29uc29sZS5sb2coJ/CfkrMgQ3JlYXRpbmcgZGVwb3NpdCBvcmRlci4uLicpO1xuICAgICAgY29uc3QgZGVwb3NpdFJlc3VsdCA9IGF3YWl0IHhnYXRlU2VydmljZS5jcmVhdGVEZXBvc2l0KHtcbiAgICAgICAgY3VzdG9tZXJJZDogY3VzdG9tZXJJZCxcbiAgICAgICAgY3VycmVuY3lJZDogYnJsQ3VycmVuY3kuX2lkLFxuICAgICAgICBjcnlwdG9JZDogdXNkdENyeXB0by5faWQsXG4gICAgICAgIGFtb3VudDogYW1vdW50LFxuICAgICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24sXG4gICAgICAgIHdlYmhvb2tVcmw6IHByb2Nlc3MuZW52LlhHQVRFX1dFQkhPT0tfVVJMIHx8ICdodHRwczovLzJiOGQxMzE4NGY5OS5uZ3Jvay5hcHAvYXBpL3hnYXRlL3dlYmhvb2snXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFkZXBvc2l0UmVzdWx0LnN1Y2Nlc3MgfHwgIWRlcG9zaXRSZXN1bHQuZGF0YSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYERlcG9zaXQgY3JlYXRpb24gZmFpbGVkOiAke2RlcG9zaXRSZXN1bHQuZXJyb3J9YCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKCfinIUgRGVwb3NpdCBjcmVhdGVkOicsIGRlcG9zaXRSZXN1bHQuZGF0YS5pZCk7XG5cbiAgICAgIC8vIENyZWF0ZSBwZW5kaW5nIHRyYW5zYWN0aW9uIGluIGRhdGFiYXNlXG4gICAgICB0cnkge1xuICAgICAgICAvLyBVc2luZyBhdXRoZW50aWNhdGVkIHVzZXIgSURcbiAgICAgICAgY29uc3QgdXNlcklkID0gY3VycmVudFVzZXIuaWQ7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCB3YWxsZXRTZXJ2aWNlLmNyZWF0ZVBlbmRpbmdUcmFuc2FjdGlvbih7XG4gICAgICAgICAgdXNlcklkOiB1c2VySWQsXG4gICAgICAgICAgdHlwZTogJ0RFUE9TSVQnLFxuICAgICAgICAgIGFtb3VudDogY2FsY3VsYXRlZFVzZHRBbW91bnQsXG4gICAgICAgICAgcGl4Q29kZTogZGVwb3NpdFJlc3VsdC5kYXRhLnBpeENvZGUsXG4gICAgICAgICAgcGl4VHJhbnNhY3Rpb25JZDogZGVwb3NpdFJlc3VsdC5kYXRhLmlkLFxuICAgICAgICAgIGJybEFtb3VudDogYW1vdW50LFxuICAgICAgICAgIGV4Y2hhbmdlUmF0ZTogZXhjaGFuZ2VSYXRlLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbixcbiAgICAgICAgICBleHRlcm5hbElkOiBkZXBvc2l0UmVzdWx0LmRhdGEuaWRcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc29sZS5sb2coJ+KchSBQZW5kaW5nIHRyYW5zYWN0aW9uIGNyZWF0ZWQgaW4gZGF0YWJhc2U6Jywge1xuICAgICAgICAgIHVzZXJJZDogY3VycmVudFVzZXIuaWQsXG4gICAgICAgICAgdXNlckVtYWlsOiBjdXJyZW50VXNlci5lbWFpbCxcbiAgICAgICAgICBwaXhUcmFuc2FjdGlvbklkOiBkZXBvc2l0UmVzdWx0LmRhdGEuaWQsXG4gICAgICAgICAgdXNkdEFtb3VudDogY2FsY3VsYXRlZFVzZHRBbW91bnRcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChkYkVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KaoO+4jyBGYWlsZWQgdG8gY3JlYXRlIHBlbmRpbmcgdHJhbnNhY3Rpb24gaW4gZGF0YWJhc2U6JywgZGJFcnJvcik7XG4gICAgICAgIC8vIENvbnRpbnVlIGFueXdheSAtIHRoZSB3ZWJob29rIGNhbiBzdGlsbCBwcm9jZXNzIHRoZSBwYXltZW50XG4gICAgICB9XG5cbiAgICAgIC8vIEdlbmVyYXRlIFFSIENvZGUgVVJMIGlmIG5vdCBwcm92aWRlZFxuICAgICAgbGV0IHFyQ29kZVVybCA9IGRlcG9zaXRSZXN1bHQuZGF0YS5xckNvZGVVcmw7XG4gICAgICBpZiAoIXFyQ29kZVVybCAmJiBkZXBvc2l0UmVzdWx0LmRhdGEucGl4Q29kZSkge1xuICAgICAgICBxckNvZGVVcmwgPSBgaHR0cHM6Ly9hcGkucXJzZXJ2ZXIuY29tL3YxL2NyZWF0ZS1xci1jb2RlLz9zaXplPTI1NngyNTYmZGF0YT0ke2VuY29kZVVSSUNvbXBvbmVudChkZXBvc2l0UmVzdWx0LmRhdGEucGl4Q29kZSl9YDtcbiAgICAgIH1cblxuICAgICAgLy8gUmV0dXJuIHN0YW5kYXJkaXplZCByZXNwb25zZVxuICAgICAgY29uc3QgcmVzcG9uc2UgPSB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIHBpeENvZGU6IGRlcG9zaXRSZXN1bHQuZGF0YS5waXhDb2RlLFxuICAgICAgICB0cmFuc2FjdGlvbklkOiBkZXBvc2l0UmVzdWx0LmRhdGEuaWQsXG4gICAgICAgIHN0YXR1czogZGVwb3NpdFJlc3VsdC5kYXRhLnN0YXR1cyxcbiAgICAgICAgYW1vdW50OiBkZXBvc2l0UmVzdWx0LmRhdGEuYW1vdW50LFxuICAgICAgICB1c2R0QW1vdW50OiBkZXBvc2l0UmVzdWx0LmRhdGEuY3J5cHRvQW1vdW50LFxuICAgICAgICBleHBpcmVzQXQ6IGRlcG9zaXRSZXN1bHQuZGF0YS5leHBpcmVzQXQsXG4gICAgICAgIHFyQ29kZVVybDogcXJDb2RlVXJsLFxuICAgICAgICAvLyBMZWdhY3kgZmllbGRzIGZvciBjb21wYXRpYmlsaXR5XG4gICAgICAgIGlkOiBkZXBvc2l0UmVzdWx0LmRhdGEuaWQsXG4gICAgICAgIHFyQ29kZVRleHQ6IGRlcG9zaXRSZXN1bHQuZGF0YS5waXhDb2RlLFxuICAgICAgICBleGNoYW5nZVJhdGU6IGV4Y2hhbmdlUmF0ZSxcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIHR5cGU6ICd1c2R0X3B1cmNoYXNlJyxcbiAgICAgICAgcHJvdmlkZXI6ICd4Z2F0ZSdcbiAgICAgIH07XG5cbiAgICAgIGNvbnNvbGUubG9nKCfwn46JIFVTRFQgb3JkZXIgY3JlYXRlZCBzdWNjZXNzZnVsbHkhJyk7XG4gICAgICBjb25zb2xlLmxvZygn8J+TiiBGaW5hbCByZXNwb25zZTonLCB7XG4gICAgICAgIGlkOiByZXNwb25zZS5pZCxcbiAgICAgICAgYW1vdW50OiBgUiQgJHtyZXNwb25zZS5hbW91bnR9YCxcbiAgICAgICAgdXNkdDogYCR7cmVzcG9uc2UudXNkdEFtb3VudH0gVVNEVGAsXG4gICAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHJlc3BvbnNlKTtcblxuICAgIH0gY2F0Y2ggKHhnYXRlRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBYR2F0ZSBpbnRlZ3JhdGlvbiBlcnJvcjonLCB4Z2F0ZUVycm9yKTtcbiAgICAgIFxuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gKHhnYXRlRXJyb3IgYXMgRXJyb3IpLm1lc3NhZ2U7XG4gICAgICBsZXQgZXJyb3JDb2RlID0gJ1hHQVRFX0VSUk9SJztcbiAgICAgIFxuICAgICAgaWYgKGVycm9yTWVzc2FnZS5pbmNsdWRlcygnQXV0aGVudGljYXRpb24nKSB8fCBlcnJvck1lc3NhZ2UuaW5jbHVkZXMoJ2NyZWRlbnRpYWxzJykpIHtcbiAgICAgICAgZXJyb3JDb2RlID0gJ0FVVEhfRVJST1InO1xuICAgICAgfSBlbHNlIGlmIChlcnJvck1lc3NhZ2UuaW5jbHVkZXMoJ25vdCBhdmFpbGFibGUnKSB8fCBlcnJvck1lc3NhZ2UuaW5jbHVkZXMoJ25vdCBmb3VuZCcpKSB7XG4gICAgICAgIGVycm9yQ29kZSA9ICdWQUxJREFUSU9OX0VSUk9SJztcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IFxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiBgWEdhdGUgZXJyb3I6ICR7ZXJyb3JNZXNzYWdlfWAsXG4gICAgICAgICAgY29kZTogZXJyb3JDb2RlXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgY3JlYXRpbmcgVVNEVCBvcmRlcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnRXJybyBpbnRlcm5vIGFvIGNyaWFyIG9yZGVtIFVTRFQnLFxuICAgICAgICBjb2RlOiAnSU5URVJOQUxfRVJST1InXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufSJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJnZXRYR2F0ZVNlcnZpY2UiLCJ3YWxsZXRTZXJ2aWNlIiwiZ2V0Q3VycmVudFVzZXIiLCJwcmljZUNhbGN1bGF0b3IiLCJQT1NUIiwicmVxdWVzdCIsImN1cnJlbnRVc2VyIiwianNvbiIsInN1Y2Nlc3MiLCJlcnJvciIsImNvZGUiLCJzdGF0dXMiLCJhbW91bnQiLCJ1c2R0QW1vdW50IiwibmFtZSIsInRheElkIiwiZGVzY3JpcHRpb24iLCJleHRlcm5hbElkIiwiY29uc29sZSIsImxvZyIsInN1YnN0cmluZyIsInhnYXRlU2VydmljZSIsImluaXRpYWxpemVkIiwibG9hZEN1cnJlbmNpZXNBbmRDcnlwdG9zIiwiRXJyb3IiLCJicmxDdXJyZW5jeSIsImdldEJSTEN1cnJlbmN5IiwidXNkdENyeXB0byIsImdldFVTRFRDcnlwdG8iLCJicmwiLCJfaWQiLCJpZCIsInVzZHQiLCJxdW90ZSIsImdldFF1b3RlIiwicHJpY2VDYWxjdWxhdGlvbiIsImNhbGN1bGF0ZVVTRFRBbW91bnQiLCJ1c2VySWQiLCJicmxBbW91bnQiLCJ1c2R0UHJpY2UiLCJzZWxsZXJGZWUiLCJwcmljZVBlclVzZHQiLCJjYWxjdWxhdGVkVXNkdEFtb3VudCIsImV4Y2hhbmdlUmF0ZSIsImRhdGEiLCJmcm9tIiwiZnJvbUFtb3VudCIsInRvIiwidG9BbW91bnQiLCJyYXRlIiwibm90ZSIsImN1c3RvbWVySWQiLCJjcmVhdGVPckdldEN1c3RvbWVyIiwiRGF0ZSIsIm5vdyIsInJlcGxhY2UiLCJkZXBvc2l0UmVzdWx0IiwiY3JlYXRlRGVwb3NpdCIsImN1cnJlbmN5SWQiLCJjcnlwdG9JZCIsIndlYmhvb2tVcmwiLCJwcm9jZXNzIiwiZW52IiwiWEdBVEVfV0VCSE9PS19VUkwiLCJjcmVhdGVQZW5kaW5nVHJhbnNhY3Rpb24iLCJ0eXBlIiwicGl4Q29kZSIsInBpeFRyYW5zYWN0aW9uSWQiLCJ1c2VyRW1haWwiLCJlbWFpbCIsImRiRXJyb3IiLCJxckNvZGVVcmwiLCJlbmNvZGVVUklDb21wb25lbnQiLCJyZXNwb25zZSIsInRyYW5zYWN0aW9uSWQiLCJjcnlwdG9BbW91bnQiLCJleHBpcmVzQXQiLCJxckNvZGVUZXh0IiwiY3JlYXRlZEF0IiwidG9JU09TdHJpbmciLCJwcm92aWRlciIsInhnYXRlRXJyb3IiLCJlcnJvck1lc3NhZ2UiLCJtZXNzYWdlIiwiZXJyb3JDb2RlIiwiaW5jbHVkZXMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/xgate/usdt/create/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getCurrentAdmin: () => (/* binding */ getCurrentAdmin),\n/* harmony export */   getCurrentUser: () => (/* binding */ getCurrentUser),\n/* harmony export */   requireAuth: () => (/* binding */ requireAuth)\n/* harmony export */ });\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jsonwebtoken */ \"(rsc)/../../node_modules/.pnpm/jsonwebtoken@9.0.2/node_modules/jsonwebtoken/index.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _prisma__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./prisma */ \"(rsc)/./src/lib/prisma.ts\");\n\n\nasync function getCurrentUser(request) {\n    try {\n        // Get token from cookie\n        const token = request.cookies.get(\"auth-token\")?.value;\n        if (!token) {\n            console.log(\"\\uD83D\\uDD0D No auth token found\");\n            return null;\n        }\n        // Verify JWT token\n        const decoded = (0,jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__.verify)(token, process.env.JWT_SECRET || \"temp-secret-key-for-dev\");\n        if (!decoded.userId) {\n            console.log(\"\\uD83D\\uDD0D Invalid token format\");\n            return null;\n        }\n        // Get user from database\n        const user = await _prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.user.findUnique({\n            where: {\n                id: decoded.userId\n            }\n        });\n        if (!user) {\n            console.log(\"\\uD83D\\uDD0D User not found in database:\", decoded.userId);\n            return null;\n        }\n        const authUser = {\n            id: user.id,\n            email: user.email,\n            name: user.name,\n            role: user.role,\n            accountType: user.accountType,\n            companyName: user.companyName || undefined,\n            status: user.status\n        };\n        console.log(\"✅ User authenticated from database:\", {\n            id: authUser.id,\n            email: authUser.email,\n            role: authUser.role\n        });\n        return authUser;\n    } catch (error) {\n        console.error(\"❌ Error getting current user:\", error);\n        return null;\n    }\n}\n// Helper para verificar se usuário está autenticado\nasync function requireAuth(request) {\n    const user = await getCurrentUser(request);\n    if (!user) {\n        throw new Error(\"Usu\\xe1rio n\\xe3o autenticado\");\n    }\n    return user;\n}\n// Helper para verificar se usuário é admin\nasync function getCurrentAdmin(request) {\n    const user = await getCurrentUser(request);\n    if (!user) {\n        throw new Error(\"Usu\\xe1rio n\\xe3o autenticado\");\n    }\n    if (user.role !== \"ADMIN\") {\n        throw new Error(\"Acesso negado - privil\\xe9gios de administrador necess\\xe1rios\");\n    }\n    return user;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2F1dGgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQ3NDO0FBQ0o7QUFZM0IsZUFBZUUsZUFBZUMsT0FBb0I7SUFDdkQsSUFBSTtRQUNGLHdCQUF3QjtRQUN4QixNQUFNQyxRQUFRRCxRQUFRRSxPQUFPLENBQUNDLEdBQUcsQ0FBQyxlQUFlQztRQUVqRCxJQUFJLENBQUNILE9BQU87WUFDVkksUUFBUUMsR0FBRyxDQUFDO1lBQ1osT0FBTztRQUNUO1FBRUEsbUJBQW1CO1FBQ25CLE1BQU1DLFVBQVVWLG9EQUFNQSxDQUFDSSxPQUFPTyxRQUFRQyxHQUFHLENBQUNDLFVBQVUsSUFBSTtRQUV4RCxJQUFJLENBQUNILFFBQVFJLE1BQU0sRUFBRTtZQUNuQk4sUUFBUUMsR0FBRyxDQUFDO1lBQ1osT0FBTztRQUNUO1FBRUEseUJBQXlCO1FBQ3pCLE1BQU1NLE9BQU8sTUFBTWQsMkNBQU1BLENBQUNjLElBQUksQ0FBQ0MsVUFBVSxDQUFDO1lBQ3hDQyxPQUFPO2dCQUFFQyxJQUFJUixRQUFRSSxNQUFNO1lBQUM7UUFDOUI7UUFFQSxJQUFJLENBQUNDLE1BQU07WUFDVFAsUUFBUUMsR0FBRyxDQUFDLDRDQUFrQ0MsUUFBUUksTUFBTTtZQUM1RCxPQUFPO1FBQ1Q7UUFFQSxNQUFNSyxXQUFpQjtZQUNyQkQsSUFBSUgsS0FBS0csRUFBRTtZQUNYRSxPQUFPTCxLQUFLSyxLQUFLO1lBQ2pCQyxNQUFNTixLQUFLTSxJQUFJO1lBQ2ZDLE1BQU1QLEtBQUtPLElBQUk7WUFDZkMsYUFBYVIsS0FBS1EsV0FBVztZQUM3QkMsYUFBYVQsS0FBS1MsV0FBVyxJQUFJQztZQUNqQ0MsUUFBUVgsS0FBS1csTUFBTTtRQUNyQjtRQUVBbEIsUUFBUUMsR0FBRyxDQUFDLHVDQUF1QztZQUNqRFMsSUFBSUMsU0FBU0QsRUFBRTtZQUNmRSxPQUFPRCxTQUFTQyxLQUFLO1lBQ3JCRSxNQUFNSCxTQUFTRyxJQUFJO1FBQ3JCO1FBRUEsT0FBT0g7SUFFVCxFQUFFLE9BQU9RLE9BQU87UUFDZG5CLFFBQVFtQixLQUFLLENBQUMsaUNBQWlDQTtRQUMvQyxPQUFPO0lBQ1Q7QUFDRjtBQUVBLG9EQUFvRDtBQUM3QyxlQUFlQyxZQUFZekIsT0FBb0I7SUFDcEQsTUFBTVksT0FBTyxNQUFNYixlQUFlQztJQUVsQyxJQUFJLENBQUNZLE1BQU07UUFDVCxNQUFNLElBQUljLE1BQU07SUFDbEI7SUFFQSxPQUFPZDtBQUNUO0FBRUEsMkNBQTJDO0FBQ3BDLGVBQWVlLGdCQUFnQjNCLE9BQW9CO0lBQ3hELE1BQU1ZLE9BQU8sTUFBTWIsZUFBZUM7SUFFbEMsSUFBSSxDQUFDWSxNQUFNO1FBQ1QsTUFBTSxJQUFJYyxNQUFNO0lBQ2xCO0lBRUEsSUFBSWQsS0FBS08sSUFBSSxLQUFLLFNBQVM7UUFDekIsTUFBTSxJQUFJTyxNQUFNO0lBQ2xCO0lBRUEsT0FBT2Q7QUFDVCIsInNvdXJjZXMiOlsid2VicGFjazovL0BudXR6YmV0YS93ZWIvLi9zcmMvbGliL2F1dGgudHM/NjY5MiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IHZlcmlmeSB9IGZyb20gJ2pzb253ZWJ0b2tlbic7XG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuL3ByaXNtYSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXNlciB7XG4gIGlkOiBzdHJpbmc7XG4gIGVtYWlsOiBzdHJpbmc7XG4gIG5hbWU6IHN0cmluZztcbiAgcm9sZTogJ1NVUEVSX0FETUlOJyB8ICdBRE1JTicgfCAnT1dORVInIHwgJ01FTUJFUic7XG4gIGFjY291bnRUeXBlPzogJ1BGJyB8ICdQSic7XG4gIGNvbXBhbnlOYW1lPzogc3RyaW5nO1xuICBzdGF0dXM/OiAnUEVORElORycgfCAnQUNUSVZFJyB8ICdTVVNQRU5ERUQnO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q3VycmVudFVzZXIocmVxdWVzdDogTmV4dFJlcXVlc3QpOiBQcm9taXNlPFVzZXIgfCBudWxsPiB7XG4gIHRyeSB7XG4gICAgLy8gR2V0IHRva2VuIGZyb20gY29va2llXG4gICAgY29uc3QgdG9rZW4gPSByZXF1ZXN0LmNvb2tpZXMuZ2V0KCdhdXRoLXRva2VuJyk/LnZhbHVlO1xuICAgIFxuICAgIGlmICghdG9rZW4pIHtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SNIE5vIGF1dGggdG9rZW4gZm91bmQnKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8vIFZlcmlmeSBKV1QgdG9rZW5cbiAgICBjb25zdCBkZWNvZGVkID0gdmVyaWZ5KHRva2VuLCBwcm9jZXNzLmVudi5KV1RfU0VDUkVUIHx8ICd0ZW1wLXNlY3JldC1rZXktZm9yLWRldicpIGFzIGFueTtcbiAgICBcbiAgICBpZiAoIWRlY29kZWQudXNlcklkKSB7XG4gICAgICBjb25zb2xlLmxvZygn8J+UjSBJbnZhbGlkIHRva2VuIGZvcm1hdCcpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLy8gR2V0IHVzZXIgZnJvbSBkYXRhYmFzZVxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kVW5pcXVlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiBkZWNvZGVkLnVzZXJJZCB9XG4gICAgfSk7XG5cbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SNIFVzZXIgbm90IGZvdW5kIGluIGRhdGFiYXNlOicsIGRlY29kZWQudXNlcklkKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IGF1dGhVc2VyOiBVc2VyID0ge1xuICAgICAgaWQ6IHVzZXIuaWQsXG4gICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgIG5hbWU6IHVzZXIubmFtZSxcbiAgICAgIHJvbGU6IHVzZXIucm9sZSBhcyBhbnksXG4gICAgICBhY2NvdW50VHlwZTogdXNlci5hY2NvdW50VHlwZSBhcyBhbnksXG4gICAgICBjb21wYW55TmFtZTogdXNlci5jb21wYW55TmFtZSB8fCB1bmRlZmluZWQsXG4gICAgICBzdGF0dXM6IHVzZXIuc3RhdHVzIGFzIGFueVxuICAgIH07XG5cbiAgICBjb25zb2xlLmxvZygn4pyFIFVzZXIgYXV0aGVudGljYXRlZCBmcm9tIGRhdGFiYXNlOicsIHtcbiAgICAgIGlkOiBhdXRoVXNlci5pZCxcbiAgICAgIGVtYWlsOiBhdXRoVXNlci5lbWFpbCxcbiAgICAgIHJvbGU6IGF1dGhVc2VyLnJvbGVcbiAgICB9KTtcblxuICAgIHJldHVybiBhdXRoVXNlcjtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBnZXR0aW5nIGN1cnJlbnQgdXNlcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLy8gSGVscGVyIHBhcmEgdmVyaWZpY2FyIHNlIHVzdcOhcmlvIGVzdMOhIGF1dGVudGljYWRvXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVxdWlyZUF1dGgocmVxdWVzdDogTmV4dFJlcXVlc3QpOiBQcm9taXNlPFVzZXI+IHtcbiAgY29uc3QgdXNlciA9IGF3YWl0IGdldEN1cnJlbnRVc2VyKHJlcXVlc3QpO1xuICBcbiAgaWYgKCF1c2VyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdVc3XDoXJpbyBuw6NvIGF1dGVudGljYWRvJyk7XG4gIH1cbiAgXG4gIHJldHVybiB1c2VyO1xufVxuXG4vLyBIZWxwZXIgcGFyYSB2ZXJpZmljYXIgc2UgdXN1w6FyaW8gw6kgYWRtaW5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDdXJyZW50QWRtaW4ocmVxdWVzdDogTmV4dFJlcXVlc3QpOiBQcm9taXNlPFVzZXI+IHtcbiAgY29uc3QgdXNlciA9IGF3YWl0IGdldEN1cnJlbnRVc2VyKHJlcXVlc3QpO1xuICBcbiAgaWYgKCF1c2VyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdVc3XDoXJpbyBuw6NvIGF1dGVudGljYWRvJyk7XG4gIH1cblxuICBpZiAodXNlci5yb2xlICE9PSAnQURNSU4nKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdBY2Vzc28gbmVnYWRvIC0gcHJpdmlsw6lnaW9zIGRlIGFkbWluaXN0cmFkb3IgbmVjZXNzw6FyaW9zJyk7XG4gIH1cbiAgXG4gIHJldHVybiB1c2VyO1xufSJdLCJuYW1lcyI6WyJ2ZXJpZnkiLCJwcmlzbWEiLCJnZXRDdXJyZW50VXNlciIsInJlcXVlc3QiLCJ0b2tlbiIsImNvb2tpZXMiLCJnZXQiLCJ2YWx1ZSIsImNvbnNvbGUiLCJsb2ciLCJkZWNvZGVkIiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJ1c2VySWQiLCJ1c2VyIiwiZmluZFVuaXF1ZSIsIndoZXJlIiwiaWQiLCJhdXRoVXNlciIsImVtYWlsIiwibmFtZSIsInJvbGUiLCJhY2NvdW50VHlwZSIsImNvbXBhbnlOYW1lIiwidW5kZWZpbmVkIiwic3RhdHVzIiwiZXJyb3IiLCJyZXF1aXJlQXV0aCIsIkVycm9yIiwiZ2V0Q3VycmVudEFkbWluIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/priceCalculator.ts":
/*!************************************!*\
  !*** ./src/lib/priceCalculator.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PriceCalculatorService: () => (/* binding */ PriceCalculatorService),\n/* harmony export */   priceCalculator: () => (/* binding */ priceCalculator)\n/* harmony export */ });\nclass PriceCalculatorService {\n    // Buscar cotação USDT/BRL da CoinMarketCap\n    async getUSDTPrice() {\n        try {\n            // Use absolute URL for server-side fetch\n            const baseUrl = \"http://localhost:3001/api/v1\" || 0;\n            const response = await fetch(`${baseUrl}/api/crypto/coinmarketcap?convert=BRL`);\n            const data = await response.json();\n            if (data.success && data.data?.currentPrice) {\n                return data.data.currentPrice;\n            }\n            throw new Error(\"Failed to get USDT price from CoinMarketCap\");\n        } catch (error) {\n            console.error(\"Error fetching USDT price:\", error);\n            // Fallback para cotação aproximada\n            return 5.20; // ~R$ 5.20 por USDT\n        }\n    }\n    // Buscar taxa do seller (se logado) ou usar taxa padrão\n    async getSellerFee(userId) {\n        if (!userId) {\n            return 10; // Taxa padrão 10%\n        }\n        try {\n            // Em produção, buscar do banco\n            // const user = await prisma.user.findUnique({\n            //   where: { id: userId },\n            //   select: { exchangeRate: true, status: true }\n            // });\n            // Por enquanto, mock (você pode ajustar)\n            return 10; // 10% de taxa\n        } catch (error) {\n            console.error(\"Error fetching seller fee:\", error);\n            return 10; // Fallback\n        }\n    }\n    // Calcular preço com cotação + taxa do seller\n    async calculatePrice(usdtAmount, userId) {\n        try {\n            const [usdtPrice, sellerFeePercent] = await Promise.all([\n                this.getUSDTPrice(),\n                this.getSellerFee(userId)\n            ]);\n            // Preço base: USDT amount × cotação\n            const basePrice = usdtAmount * usdtPrice;\n            // Adicionar taxa do seller\n            const sellerFee = sellerFeePercent / 100; // 10% = 0.10\n            const finalPrice = basePrice * (1 + sellerFee);\n            // Preço por USDT com taxa\n            const pricePerUsdt = usdtPrice * (1 + sellerFee);\n            return {\n                usdtAmount,\n                brlAmount: basePrice,\n                usdtPrice,\n                sellerFee: sellerFeePercent,\n                finalPrice,\n                pricePerUsdt\n            };\n        } catch (error) {\n            console.error(\"Error calculating price:\", error);\n            throw error;\n        }\n    }\n    // Calcular quanto USDT o usuário receberá por um valor em BRL\n    async calculateUSDTAmount(brlAmount, userId) {\n        try {\n            const [usdtPrice, sellerFeePercent] = await Promise.all([\n                this.getUSDTPrice(),\n                this.getSellerFee(userId)\n            ]);\n            // Preço por USDT com taxa do seller\n            const sellerFee = sellerFeePercent / 100;\n            const pricePerUsdt = usdtPrice * (1 + sellerFee);\n            // Calcular quanto USDT o usuário receberá\n            const usdtAmount = brlAmount / pricePerUsdt;\n            return {\n                usdtAmount,\n                brlAmount,\n                usdtPrice,\n                sellerFee: sellerFeePercent,\n                finalPrice: brlAmount,\n                pricePerUsdt\n            };\n        } catch (error) {\n            console.error(\"Error calculating USDT amount:\", error);\n            throw error;\n        }\n    }\n    // Formatar preço para exibição\n    formatPrice(price) {\n        return new Intl.NumberFormat(\"pt-BR\", {\n            style: \"currency\",\n            currency: \"BRL\"\n        }).format(price);\n    }\n    // Formatar USDT para exibição\n    formatUSDT(amount) {\n        return new Intl.NumberFormat(\"pt-BR\", {\n            minimumFractionDigits: 2,\n            maximumFractionDigits: 6\n        }).format(amount) + \" USDT\";\n    }\n}\n// Singleton\nconst priceCalculator = new PriceCalculatorService();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUE4QjtJQUM5Qk0sV0FBV0MsTUFBYyxFQUFVO1FBQ2pDLE9BQU8sSUFBSU4sS0FBS0MsWUFBWSxDQUFDLFNBQVM7WUFDcENNLHVCQUF1QjtZQUN2QkMsdUJBQXVCO1FBQ3pCLEdBQUdKLE1BQU0sQ0FBQ0UsVUFBVTtJQUN0QjtBQUNGO0FBRUEsWUFBWTtBQUNMLE1BQU1HLGtCQUFrQixJQUFJeEMseUJBQXlCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQG51dHpiZXRhL3dlYi8uL3NyYy9saWIvcHJpY2VDYWxjdWxhdG9yLnRzPzhlYmMiXSwic291cmNlc0NvbnRlbnQiOlsiaW50ZXJmYWNlIFByaWNlQ2FsY3VsYXRpb24ge1xuICB1c2R0QW1vdW50OiBudW1iZXI7XG4gIGJybEFtb3VudDogbnVtYmVyO1xuICB1c2R0UHJpY2U6IG51bWJlcjsgLy8gQ290YcOnw6NvIFVTRFQgZW0gQlJMXG4gIHNlbGxlckZlZTogbnVtYmVyOyAvLyBUYXhhIGRvIHNlbGxlciBlbSAlXG4gIGZpbmFsUHJpY2U6IG51bWJlcjsgLy8gUHJlw6dvIGZpbmFsIGNvbSB0YXhhXG4gIHByaWNlUGVyVXNkdDogbnVtYmVyOyAvLyBQcmXDp28gcG9yIFVTRFRcbn1cblxuZXhwb3J0IGNsYXNzIFByaWNlQ2FsY3VsYXRvclNlcnZpY2Uge1xuICBcbiAgLy8gQnVzY2FyIGNvdGHDp8OjbyBVU0RUL0JSTCBkYSBDb2luTWFya2V0Q2FwXG4gIGFzeW5jIGdldFVTRFRQcmljZSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBVc2UgYWJzb2x1dGUgVVJMIGZvciBzZXJ2ZXItc2lkZSBmZXRjaFxuICAgICAgY29uc3QgYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0FQSV9VUkwgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCc7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke2Jhc2VVcmx9L2FwaS9jcnlwdG8vY29pbm1hcmtldGNhcD9jb252ZXJ0PUJSTGApO1xuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIFxuICAgICAgaWYgKGRhdGEuc3VjY2VzcyAmJiBkYXRhLmRhdGE/LmN1cnJlbnRQcmljZSkge1xuICAgICAgICByZXR1cm4gZGF0YS5kYXRhLmN1cnJlbnRQcmljZTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gZ2V0IFVTRFQgcHJpY2UgZnJvbSBDb2luTWFya2V0Q2FwJyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIFVTRFQgcHJpY2U6JywgZXJyb3IpO1xuICAgICAgLy8gRmFsbGJhY2sgcGFyYSBjb3Rhw6fDo28gYXByb3hpbWFkYVxuICAgICAgcmV0dXJuIDUuMjA7IC8vIH5SJCA1LjIwIHBvciBVU0RUXG4gICAgfVxuICB9XG5cbiAgLy8gQnVzY2FyIHRheGEgZG8gc2VsbGVyIChzZSBsb2dhZG8pIG91IHVzYXIgdGF4YSBwYWRyw6NvXG4gIGFzeW5jIGdldFNlbGxlckZlZSh1c2VySWQ/OiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGlmICghdXNlcklkKSB7XG4gICAgICByZXR1cm4gMTA7IC8vIFRheGEgcGFkcsOjbyAxMCVcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgLy8gRW0gcHJvZHXDp8OjbywgYnVzY2FyIGRvIGJhbmNvXG4gICAgICAvLyBjb25zdCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICAvLyAgIHdoZXJlOiB7IGlkOiB1c2VySWQgfSxcbiAgICAgIC8vICAgc2VsZWN0OiB7IGV4Y2hhbmdlUmF0ZTogdHJ1ZSwgc3RhdHVzOiB0cnVlIH1cbiAgICAgIC8vIH0pO1xuICAgICAgXG4gICAgICAvLyBQb3IgZW5xdWFudG8sIG1vY2sgKHZvY8OqIHBvZGUgYWp1c3RhcilcbiAgICAgIHJldHVybiAxMDsgLy8gMTAlIGRlIHRheGFcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgc2VsbGVyIGZlZTonLCBlcnJvcik7XG4gICAgICByZXR1cm4gMTA7IC8vIEZhbGxiYWNrXG4gICAgfVxuICB9XG5cbiAgLy8gQ2FsY3VsYXIgcHJlw6dvIGNvbSBjb3Rhw6fDo28gKyB0YXhhIGRvIHNlbGxlclxuICBhc3luYyBjYWxjdWxhdGVQcmljZSh1c2R0QW1vdW50OiBudW1iZXIsIHVzZXJJZD86IHN0cmluZyk6IFByb21pc2U8UHJpY2VDYWxjdWxhdGlvbj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBbdXNkdFByaWNlLCBzZWxsZXJGZWVQZXJjZW50XSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgdGhpcy5nZXRVU0RUUHJpY2UoKSxcbiAgICAgICAgdGhpcy5nZXRTZWxsZXJGZWUodXNlcklkKVxuICAgICAgXSk7XG5cbiAgICAgIC8vIFByZcOnbyBiYXNlOiBVU0RUIGFtb3VudCDDlyBjb3Rhw6fDo29cbiAgICAgIGNvbnN0IGJhc2VQcmljZSA9IHVzZHRBbW91bnQgKiB1c2R0UHJpY2U7XG4gICAgICBcbiAgICAgIC8vIEFkaWNpb25hciB0YXhhIGRvIHNlbGxlclxuICAgICAgY29uc3Qgc2VsbGVyRmVlID0gc2VsbGVyRmVlUGVyY2VudCAvIDEwMDsgLy8gMTAlID0gMC4xMFxuICAgICAgY29uc3QgZmluYWxQcmljZSA9IGJhc2VQcmljZSAqICgxICsgc2VsbGVyRmVlKTtcbiAgICAgIFxuICAgICAgLy8gUHJlw6dvIHBvciBVU0RUIGNvbSB0YXhhXG4gICAgICBjb25zdCBwcmljZVBlclVzZHQgPSB1c2R0UHJpY2UgKiAoMSArIHNlbGxlckZlZSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZHRBbW91bnQsXG4gICAgICAgIGJybEFtb3VudDogYmFzZVByaWNlLFxuICAgICAgICB1c2R0UHJpY2UsXG4gICAgICAgIHNlbGxlckZlZTogc2VsbGVyRmVlUGVyY2VudCxcbiAgICAgICAgZmluYWxQcmljZSxcbiAgICAgICAgcHJpY2VQZXJVc2R0XG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjYWxjdWxhdGluZyBwcmljZTonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvLyBDYWxjdWxhciBxdWFudG8gVVNEVCBvIHVzdcOhcmlvIHJlY2ViZXLDoSBwb3IgdW0gdmFsb3IgZW0gQlJMXG4gIGFzeW5jIGNhbGN1bGF0ZVVTRFRBbW91bnQoYnJsQW1vdW50OiBudW1iZXIsIHVzZXJJZD86IHN0cmluZyk6IFByb21pc2U8UHJpY2VDYWxjdWxhdGlvbj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBbdXNkdFByaWNlLCBzZWxsZXJGZWVQZXJjZW50XSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgdGhpcy5nZXRVU0RUUHJpY2UoKSxcbiAgICAgICAgdGhpcy5nZXRTZWxsZXJGZWUodXNlcklkKVxuICAgICAgXSk7XG5cbiAgICAgIC8vIFByZcOnbyBwb3IgVVNEVCBjb20gdGF4YSBkbyBzZWxsZXJcbiAgICAgIGNvbnN0IHNlbGxlckZlZSA9IHNlbGxlckZlZVBlcmNlbnQgLyAxMDA7XG4gICAgICBjb25zdCBwcmljZVBlclVzZHQgPSB1c2R0UHJpY2UgKiAoMSArIHNlbGxlckZlZSk7XG4gICAgICBcbiAgICAgIC8vIENhbGN1bGFyIHF1YW50byBVU0RUIG8gdXN1w6FyaW8gcmVjZWJlcsOhXG4gICAgICBjb25zdCB1c2R0QW1vdW50ID0gYnJsQW1vdW50IC8gcHJpY2VQZXJVc2R0O1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2R0QW1vdW50LFxuICAgICAgICBicmxBbW91bnQsXG4gICAgICAgIHVzZHRQcmljZSxcbiAgICAgICAgc2VsbGVyRmVlOiBzZWxsZXJGZWVQZXJjZW50LFxuICAgICAgICBmaW5hbFByaWNlOiBicmxBbW91bnQsXG4gICAgICAgIHByaWNlUGVyVXNkdFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY2FsY3VsYXRpbmcgVVNEVCBhbW91bnQ6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLy8gRm9ybWF0YXIgcHJlw6dvIHBhcmEgZXhpYmnDp8Ojb1xuICBmb3JtYXRQcmljZShwcmljZTogbnVtYmVyKTogc3RyaW5nIHtcbiAgICByZXR1cm4gbmV3IEludGwuTnVtYmVyRm9ybWF0KCdwdC1CUicsIHtcbiAgICAgIHN0eWxlOiAnY3VycmVuY3knLFxuICAgICAgY3VycmVuY3k6ICdCUkwnXG4gICAgfSkuZm9ybWF0KHByaWNlKTtcbiAgfVxuXG4gIC8vIEZvcm1hdGFyIFVTRFQgcGFyYSBleGliacOnw6NvXG4gIGZvcm1hdFVTRFQoYW1vdW50OiBudW1iZXIpOiBzdHJpbmcge1xuICAgIHJldHVybiBuZXcgSW50bC5OdW1iZXJGb3JtYXQoJ3B0LUJSJywge1xuICAgICAgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyLFxuICAgICAgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiA2XG4gICAgfSkuZm9ybWF0KGFtb3VudCkgKyAnIFVTRFQnO1xuICB9XG59XG5cbi8vIFNpbmdsZXRvblxuZXhwb3J0IGNvbnN0IHByaWNlQ2FsY3VsYXRvciA9IG5ldyBQcmljZUNhbGN1bGF0b3JTZXJ2aWNlKCk7Il0sIm5hbWVzIjpbIlByaWNlQ2FsY3VsYXRvclNlcnZpY2UiLCJnZXRVU0RUUHJpY2UiLCJiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX0FQSV9VUkwiLCJyZXNwb25zZSIsImZldGNoIiwiZGF0YSIsImpzb24iLCJzdWNjZXNzIiwiY3VycmVudFByaWNlIiwiRXJyb3IiLCJlcnJvciIsImNvbnNvbGUiLCJnZXRTZWxsZXJGZWUiLCJ1c2VySWQiLCJjYWxjdWxhdGVQcmljZSIsInVzZHRBbW91bnQiLCJ1c2R0UHJpY2UiLCJzZWxsZXJGZWVQZXJjZW50IiwiUHJvbWlzZSIsImFsbCIsImJhc2VQcmljZSIsInNlbGxlckZlZSIsImZpbmFsUHJpY2UiLCJwcmljZVBlclVzZHQiLCJicmxBbW91bnQiLCJjYWxjdWxhdGVVU0RUQW1vdW50IiwiZm9ybWF0UHJpY2UiLCJwcmljZSIsIkludGwiLCJOdW1iZXJGb3JtYXQiLCJzdHlsZSIsImN1cnJlbmN5IiwiZm9ybWF0IiwiZm9ybWF0VVNEVCIsImFtb3VudCIsIm1pbmltdW1GcmFjdGlvbkRpZ2l0cyIsIm1heGltdW1GcmFjdGlvbkRpZ2l0cyIsInByaWNlQ2FsY3VsYXRvciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/priceCalculator.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/prisma.ts":
/*!***************************!*\
  !*** ./src/lib/prisma.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst globalForPrisma = globalThis;\nconst prisma = globalForPrisma.prisma ?? new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient({\n    log:  true ? [\n        \"error\",\n        \"warn\"\n    ] : 0,\n    datasources: {\n        db: {\n            url: process.env.DATABASE_URL\n        }\n    }\n});\nif (true) globalForPrisma.prisma = prisma;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3ByaXNtYS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBNkM7QUFFN0MsTUFBTUMsa0JBQWtCQztBQUlqQixNQUFNQyxTQUNYRixnQkFBZ0JFLE1BQU0sSUFDdEIsSUFBSUgsd0RBQVlBLENBQUM7SUFDZkksS0FBS0MsS0FBeUIsR0FBZ0I7UUFBQztRQUFTO0tBQU8sR0FBRyxDQUFTO0lBQzNFQyxhQUFhO1FBQ1hDLElBQUk7WUFDRkMsS0FBS0gsUUFBUUksR0FBRyxDQUFDQyxZQUFZO1FBQy9CO0lBQ0Y7QUFDRixHQUFFO0FBRUosSUFBSUwsSUFBeUIsRUFBY0osZ0JBQWdCRSxNQUFNLEdBQUdBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQG51dHpiZXRhL3dlYi8uL3NyYy9saWIvcHJpc21hLnRzPzAxZDciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnXG5cbmNvbnN0IGdsb2JhbEZvclByaXNtYSA9IGdsb2JhbFRoaXMgYXMgdW5rbm93biBhcyB7XG4gIHByaXNtYTogUHJpc21hQ2xpZW50IHwgdW5kZWZpbmVkXG59XG5cbmV4cG9ydCBjb25zdCBwcmlzbWEgPVxuICBnbG9iYWxGb3JQcmlzbWEucHJpc21hID8/XG4gIG5ldyBQcmlzbWFDbGllbnQoe1xuICAgIGxvZzogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBbJ2Vycm9yJywgJ3dhcm4nXSA6IFsnZXJyb3InXSxcbiAgICBkYXRhc291cmNlczoge1xuICAgICAgZGI6IHtcbiAgICAgICAgdXJsOiBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkxcbiAgICAgIH1cbiAgICB9XG4gIH0pXG5cbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSBnbG9iYWxGb3JQcmlzbWEucHJpc21hID0gcHJpc21hIl0sIm5hbWVzIjpbIlByaXNtYUNsaWVudCIsImdsb2JhbEZvclByaXNtYSIsImdsb2JhbFRoaXMiLCJwcmlzbWEiLCJsb2ciLCJwcm9jZXNzIiwiZGF0YXNvdXJjZXMiLCJkYiIsInVybCIsImVudiIsIkRBVEFCQVNFX1VSTCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/prisma.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/walletService.ts":
/*!**********************************!*\
  !*** ./src/lib/walletService.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   WalletService: () => (/* binding */ WalletService),\n/* harmony export */   walletService: () => (/* binding */ walletService)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst prisma = new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\nclass WalletService {\n    // Get or create wallet for user\n    async getOrCreateWallet(userId) {\n        try {\n            let wallet = await prisma.uSDTWallet.findUnique({\n                where: {\n                    userId\n                },\n                include: {\n                    user: {\n                        select: {\n                            id: true,\n                            name: true,\n                            email: true\n                        }\n                    }\n                }\n            });\n            if (!wallet) {\n                wallet = await prisma.uSDTWallet.create({\n                    data: {\n                        userId,\n                        balance: 0,\n                        frozenBalance: 0,\n                        totalDeposited: 0,\n                        totalWithdrawn: 0\n                    },\n                    include: {\n                        user: {\n                            select: {\n                                id: true,\n                                name: true,\n                                email: true\n                            }\n                        }\n                    }\n                });\n            }\n            return wallet;\n        } catch (error) {\n            console.error(\"Error getting/creating wallet:\", error);\n            throw error;\n        }\n    }\n    // Credit USDT to user wallet (for confirmed deposits)\n    async creditUSDT(data) {\n        try {\n            return await prisma.$transaction(async (tx)=>{\n                // Get wallet\n                const wallet = await this.getOrCreateWallet(data.userId);\n                // Calculate new balance\n                const newBalance = Number(wallet.balance) + data.amount;\n                const newTotalDeposited = Number(wallet.totalDeposited) + data.amount;\n                // Update wallet balance\n                const updatedWallet = await tx.uSDTWallet.update({\n                    where: {\n                        userId: data.userId\n                    },\n                    data: {\n                        balance: newBalance,\n                        totalDeposited: newTotalDeposited\n                    }\n                });\n                // Create transaction record\n                const transaction = await tx.uSDTTransaction.create({\n                    data: {\n                        walletId: wallet.id,\n                        type: data.type,\n                        status: \"COMPLETED\",\n                        amount: data.amount,\n                        balanceAfter: newBalance,\n                        pixCode: data.pixCode,\n                        pixTransactionId: data.pixTransactionId,\n                        brlAmount: data.brlAmount,\n                        exchangeRate: data.exchangeRate,\n                        description: data.description,\n                        externalId: data.externalId,\n                        metadata: data.metadata ? JSON.stringify(data.metadata) : null,\n                        processedAt: new Date()\n                    }\n                });\n                console.log(`✅ USDT credited successfully:`, {\n                    userId: data.userId,\n                    amount: data.amount,\n                    newBalance: newBalance,\n                    transactionId: transaction.id\n                });\n                return {\n                    success: true,\n                    wallet: updatedWallet,\n                    transaction,\n                    newBalance\n                };\n            });\n        } catch (error) {\n            console.error(\"Error crediting USDT:\", error);\n            throw error;\n        }\n    }\n    // Debit USDT from user wallet (for withdrawals, investments)\n    async debitUSDT(data) {\n        try {\n            return await prisma.$transaction(async (tx)=>{\n                // Get wallet\n                const wallet = await this.getOrCreateWallet(data.userId);\n                // Check if sufficient balance\n                if (Number(wallet.balance) < data.amount) {\n                    throw new Error(\"Insufficient USDT balance\");\n                }\n                // Calculate new balance\n                const newBalance = Number(wallet.balance) - data.amount;\n                const newTotalWithdrawn = Number(wallet.totalWithdrawn) + data.amount;\n                // Update wallet balance\n                const updatedWallet = await tx.uSDTWallet.update({\n                    where: {\n                        userId: data.userId\n                    },\n                    data: {\n                        balance: newBalance,\n                        totalWithdrawn: newTotalWithdrawn\n                    }\n                });\n                // Create transaction record\n                const transaction = await tx.uSDTTransaction.create({\n                    data: {\n                        walletId: wallet.id,\n                        type: data.type,\n                        status: \"COMPLETED\",\n                        amount: -data.amount,\n                        balanceAfter: newBalance,\n                        description: data.description,\n                        externalId: data.externalId,\n                        metadata: data.metadata ? JSON.stringify(data.metadata) : null,\n                        processedAt: new Date()\n                    }\n                });\n                console.log(`✅ USDT debited successfully:`, {\n                    userId: data.userId,\n                    amount: data.amount,\n                    newBalance: newBalance,\n                    transactionId: transaction.id\n                });\n                return {\n                    success: true,\n                    wallet: updatedWallet,\n                    transaction,\n                    newBalance\n                };\n            });\n        } catch (error) {\n            console.error(\"Error debiting USDT:\", error);\n            throw error;\n        }\n    }\n    // Get wallet balance\n    async getBalance(userId) {\n        try {\n            const wallet = await prisma.uSDTWallet.findUnique({\n                where: {\n                    userId\n                }\n            });\n            if (!wallet) {\n                return null;\n            }\n            return {\n                balance: Number(wallet.balance),\n                frozenBalance: Number(wallet.frozenBalance),\n                totalDeposited: Number(wallet.totalDeposited),\n                totalWithdrawn: Number(wallet.totalWithdrawn)\n            };\n        } catch (error) {\n            console.error(\"Error getting balance:\", error);\n            throw error;\n        }\n    }\n    // Get transaction history\n    async getTransactionHistory(userId, limit = 50, offset = 0) {\n        try {\n            const wallet = await this.getOrCreateWallet(userId);\n            const transactions = await prisma.uSDTTransaction.findMany({\n                where: {\n                    walletId: wallet.id\n                },\n                orderBy: {\n                    createdAt: \"desc\"\n                },\n                take: limit,\n                skip: offset\n            });\n            return {\n                transactions: transactions.map((tx)=>({\n                        ...tx,\n                        amount: Number(tx.amount),\n                        balanceAfter: tx.balanceAfter ? Number(tx.balanceAfter) : null,\n                        brlAmount: tx.brlAmount ? Number(tx.brlAmount) : null,\n                        exchangeRate: tx.exchangeRate ? Number(tx.exchangeRate) : null,\n                        metadata: tx.metadata ? JSON.parse(tx.metadata) : null\n                    })),\n                total: await prisma.uSDTTransaction.count({\n                    where: {\n                        walletId: wallet.id\n                    }\n                })\n            };\n        } catch (error) {\n            console.error(\"Error getting transaction history:\", error);\n            throw error;\n        }\n    }\n    // Create pending transaction (before PIX payment)\n    async createPendingTransaction(data) {\n        try {\n            const wallet = await this.getOrCreateWallet(data.userId);\n            const transaction = await prisma.uSDTTransaction.create({\n                data: {\n                    walletId: wallet.id,\n                    type: data.type,\n                    status: \"PENDING\",\n                    amount: data.amount,\n                    pixCode: data.pixCode,\n                    pixTransactionId: data.pixTransactionId,\n                    brlAmount: data.brlAmount,\n                    exchangeRate: data.exchangeRate,\n                    description: data.description,\n                    externalId: data.externalId,\n                    metadata: data.metadata ? JSON.stringify(data.metadata) : null\n                }\n            });\n            return transaction;\n        } catch (error) {\n            console.error(\"Error creating pending transaction:\", error);\n            throw error;\n        }\n    }\n    // Complete pending transaction (when PIX is paid)\n    async completePendingTransaction(pixTransactionId) {\n        try {\n            return await prisma.$transaction(async (tx)=>{\n                // Find pending transaction\n                const transaction = await tx.uSDTTransaction.findFirst({\n                    where: {\n                        pixTransactionId,\n                        status: \"PENDING\"\n                    },\n                    include: {\n                        wallet: true\n                    }\n                });\n                if (!transaction) {\n                    throw new Error(`Pending transaction not found for PIX ID: ${pixTransactionId}`);\n                }\n                // Update wallet balance\n                const newBalance = Number(transaction.wallet.balance) + Number(transaction.amount);\n                const newTotalDeposited = Number(transaction.wallet.totalDeposited) + Number(transaction.amount);\n                await tx.uSDTWallet.update({\n                    where: {\n                        id: transaction.walletId\n                    },\n                    data: {\n                        balance: newBalance,\n                        totalDeposited: newTotalDeposited\n                    }\n                });\n                // Update transaction status\n                const completedTransaction = await tx.uSDTTransaction.update({\n                    where: {\n                        id: transaction.id\n                    },\n                    data: {\n                        status: \"COMPLETED\",\n                        balanceAfter: newBalance,\n                        processedAt: new Date()\n                    }\n                });\n                console.log(`✅ Transaction completed:`, {\n                    transactionId: transaction.id,\n                    pixTransactionId,\n                    amount: Number(transaction.amount),\n                    newBalance\n                });\n                return {\n                    success: true,\n                    transaction: completedTransaction,\n                    newBalance\n                };\n            });\n        } catch (error) {\n            console.error(\"Error completing pending transaction:\", error);\n            throw error;\n        }\n    }\n}\n// Export singleton instance\nconst walletService = new WalletService();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixZQUFZRSxRQUFRO29CQUFDO29CQUNsQ2xCLE1BQU07d0JBQ0pDLFNBQVNTO3dCQUNUUCxnQkFBZ0JVO29CQUNsQjtnQkFDRjtnQkFFQSw0QkFBNEI7Z0JBQzVCLE1BQU0yQyx1QkFBdUIsTUFBTS9DLEdBQUdRLGVBQWUsQ0FBQ0YsTUFBTSxDQUFDO29CQUMzRHZCLE9BQU87d0JBQUVJLElBQUlvQixZQUFZcEIsRUFBRTtvQkFBQztvQkFDNUJJLE1BQU07d0JBQ0pvQixRQUFRO3dCQUNSQyxjQUFjWDt3QkFDZHFCLGFBQWEsSUFBSUM7b0JBQ25CO2dCQUNGO2dCQUVBMUIsUUFBUTJCLEdBQUcsQ0FBQyxDQUFDLHdCQUF3QixDQUFDLEVBQUU7b0JBQ3RDQyxlQUFlbEIsWUFBWXBCLEVBQUU7b0JBQzdCMkI7b0JBQ0FYLFFBQVFELE9BQU9LLFlBQVlKLE1BQU07b0JBQ2pDRjtnQkFDRjtnQkFFQSxPQUFPO29CQUNMeUIsU0FBUztvQkFDVG5CLGFBQWF3QztvQkFDYjlDO2dCQUNGO1lBQ0Y7UUFDRixFQUFFLE9BQU9MLE9BQU87WUFDZEMsUUFBUUQsS0FBSyxDQUFDLHlDQUF5Q0E7WUFDdkQsTUFBTUE7UUFDUjtJQUNGO0FBQ0Y7QUFFQSw0QkFBNEI7QUFDckIsTUFBTW9ELGdCQUFnQixJQUFJdkUsZ0JBQWdCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQG51dHpiZXRhL3dlYi8uL3NyYy9saWIvd2FsbGV0U2VydmljZS50cz9lMmQ3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByaXNtYUNsaWVudCB9IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcblxuY29uc3QgcHJpc21hID0gbmV3IFByaXNtYUNsaWVudCgpO1xuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVRyYW5zYWN0aW9uRGF0YSB7XG4gIHVzZXJJZDogc3RyaW5nO1xuICB0eXBlOiAnREVQT1NJVCcgfCAnV0lUSERSQVdBTCcgfCAnSU5WRVNUTUVOVCcgfCAnUkVUVVJOJyB8ICdUUkFOU0ZFUl9JTicgfCAnVFJBTlNGRVJfT1VUJyB8ICdBREpVU1RNRU5UJztcbiAgYW1vdW50OiBudW1iZXI7XG4gIHBpeENvZGU/OiBzdHJpbmc7XG4gIHBpeFRyYW5zYWN0aW9uSWQ/OiBzdHJpbmc7XG4gIGJybEFtb3VudD86IG51bWJlcjtcbiAgZXhjaGFuZ2VSYXRlPzogbnVtYmVyO1xuICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgZXh0ZXJuYWxJZD86IHN0cmluZztcbiAgbWV0YWRhdGE/OiBhbnk7XG59XG5cbmV4cG9ydCBjbGFzcyBXYWxsZXRTZXJ2aWNlIHtcbiAgXG4gIC8vIEdldCBvciBjcmVhdGUgd2FsbGV0IGZvciB1c2VyXG4gIGFzeW5jIGdldE9yQ3JlYXRlV2FsbGV0KHVzZXJJZDogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgIGxldCB3YWxsZXQgPSBhd2FpdCBwcmlzbWEudVNEVFdhbGxldC5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgdXNlcklkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGVtYWlsOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgaWYgKCF3YWxsZXQpIHtcbiAgICAgICAgd2FsbGV0ID0gYXdhaXQgcHJpc21hLnVTRFRXYWxsZXQuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICBiYWxhbmNlOiAwLFxuICAgICAgICAgICAgZnJvemVuQmFsYW5jZTogMCxcbiAgICAgICAgICAgIHRvdGFsRGVwb3NpdGVkOiAwLFxuICAgICAgICAgICAgdG90YWxXaXRoZHJhd246IDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgbmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogdHJ1ZVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHdhbGxldDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZy9jcmVhdGluZyB3YWxsZXQ6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLy8gQ3JlZGl0IFVTRFQgdG8gdXNlciB3YWxsZXQgKGZvciBjb25maXJtZWQgZGVwb3NpdHMpXG4gIGFzeW5jIGNyZWRpdFVTRFQoZGF0YTogQ3JlYXRlVHJhbnNhY3Rpb25EYXRhKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCBwcmlzbWEuJHRyYW5zYWN0aW9uKGFzeW5jICh0eCkgPT4ge1xuICAgICAgICAvLyBHZXQgd2FsbGV0XG4gICAgICAgIGNvbnN0IHdhbGxldCA9IGF3YWl0IHRoaXMuZ2V0T3JDcmVhdGVXYWxsZXQoZGF0YS51c2VySWQpO1xuICAgICAgICBcbiAgICAgICAgLy8gQ2FsY3VsYXRlIG5ldyBiYWxhbmNlXG4gICAgICAgIGNvbnN0IG5ld0JhbGFuY2UgPSBOdW1iZXIod2FsbGV0LmJhbGFuY2UpICsgZGF0YS5hbW91bnQ7XG4gICAgICAgIGNvbnN0IG5ld1RvdGFsRGVwb3NpdGVkID0gTnVtYmVyKHdhbGxldC50b3RhbERlcG9zaXRlZCkgKyBkYXRhLmFtb3VudDtcbiAgICAgICAgXG4gICAgICAgIC8vIFVwZGF0ZSB3YWxsZXQgYmFsYW5jZVxuICAgICAgICBjb25zdCB1cGRhdGVkV2FsbGV0ID0gYXdhaXQgdHgudVNEVFdhbGxldC51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IHVzZXJJZDogZGF0YS51c2VySWQgfSxcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBiYWxhbmNlOiBuZXdCYWxhbmNlLFxuICAgICAgICAgICAgdG90YWxEZXBvc2l0ZWQ6IG5ld1RvdGFsRGVwb3NpdGVkXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBDcmVhdGUgdHJhbnNhY3Rpb24gcmVjb3JkXG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gYXdhaXQgdHgudVNEVFRyYW5zYWN0aW9uLmNyZWF0ZSh7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgd2FsbGV0SWQ6IHdhbGxldC5pZCxcbiAgICAgICAgICAgIHR5cGU6IGRhdGEudHlwZSxcbiAgICAgICAgICAgIHN0YXR1czogJ0NPTVBMRVRFRCcsXG4gICAgICAgICAgICBhbW91bnQ6IGRhdGEuYW1vdW50LFxuICAgICAgICAgICAgYmFsYW5jZUFmdGVyOiBuZXdCYWxhbmNlLFxuICAgICAgICAgICAgcGl4Q29kZTogZGF0YS5waXhDb2RlLFxuICAgICAgICAgICAgcGl4VHJhbnNhY3Rpb25JZDogZGF0YS5waXhUcmFuc2FjdGlvbklkLFxuICAgICAgICAgICAgYnJsQW1vdW50OiBkYXRhLmJybEFtb3VudCxcbiAgICAgICAgICAgIGV4Y2hhbmdlUmF0ZTogZGF0YS5leGNoYW5nZVJhdGUsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogZGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgIGV4dGVybmFsSWQ6IGRhdGEuZXh0ZXJuYWxJZCxcbiAgICAgICAgICAgIG1ldGFkYXRhOiBkYXRhLm1ldGFkYXRhID8gSlNPTi5zdHJpbmdpZnkoZGF0YS5tZXRhZGF0YSkgOiBudWxsLFxuICAgICAgICAgICAgcHJvY2Vzc2VkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKGDinIUgVVNEVCBjcmVkaXRlZCBzdWNjZXNzZnVsbHk6YCwge1xuICAgICAgICAgIHVzZXJJZDogZGF0YS51c2VySWQsXG4gICAgICAgICAgYW1vdW50OiBkYXRhLmFtb3VudCxcbiAgICAgICAgICBuZXdCYWxhbmNlOiBuZXdCYWxhbmNlLFxuICAgICAgICAgIHRyYW5zYWN0aW9uSWQ6IHRyYW5zYWN0aW9uLmlkXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICB3YWxsZXQ6IHVwZGF0ZWRXYWxsZXQsXG4gICAgICAgICAgdHJhbnNhY3Rpb24sXG4gICAgICAgICAgbmV3QmFsYW5jZVxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWRpdGluZyBVU0RUOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8vIERlYml0IFVTRFQgZnJvbSB1c2VyIHdhbGxldCAoZm9yIHdpdGhkcmF3YWxzLCBpbnZlc3RtZW50cylcbiAgYXN5bmMgZGViaXRVU0RUKGRhdGE6IENyZWF0ZVRyYW5zYWN0aW9uRGF0YSkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gR2V0IHdhbGxldFxuICAgICAgICBjb25zdCB3YWxsZXQgPSBhd2FpdCB0aGlzLmdldE9yQ3JlYXRlV2FsbGV0KGRhdGEudXNlcklkKTtcbiAgICAgICAgXG4gICAgICAgIC8vIENoZWNrIGlmIHN1ZmZpY2llbnQgYmFsYW5jZVxuICAgICAgICBpZiAoTnVtYmVyKHdhbGxldC5iYWxhbmNlKSA8IGRhdGEuYW1vdW50KSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnN1ZmZpY2llbnQgVVNEVCBiYWxhbmNlJyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIENhbGN1bGF0ZSBuZXcgYmFsYW5jZVxuICAgICAgICBjb25zdCBuZXdCYWxhbmNlID0gTnVtYmVyKHdhbGxldC5iYWxhbmNlKSAtIGRhdGEuYW1vdW50O1xuICAgICAgICBjb25zdCBuZXdUb3RhbFdpdGhkcmF3biA9IE51bWJlcih3YWxsZXQudG90YWxXaXRoZHJhd24pICsgZGF0YS5hbW91bnQ7XG4gICAgICAgIFxuICAgICAgICAvLyBVcGRhdGUgd2FsbGV0IGJhbGFuY2VcbiAgICAgICAgY29uc3QgdXBkYXRlZFdhbGxldCA9IGF3YWl0IHR4LnVTRFRXYWxsZXQudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyB1c2VySWQ6IGRhdGEudXNlcklkIH0sXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgYmFsYW5jZTogbmV3QmFsYW5jZSxcbiAgICAgICAgICAgIHRvdGFsV2l0aGRyYXduOiBuZXdUb3RhbFdpdGhkcmF3blxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQ3JlYXRlIHRyYW5zYWN0aW9uIHJlY29yZFxuICAgICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IGF3YWl0IHR4LnVTRFRUcmFuc2FjdGlvbi5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHdhbGxldElkOiB3YWxsZXQuaWQsXG4gICAgICAgICAgICB0eXBlOiBkYXRhLnR5cGUsXG4gICAgICAgICAgICBzdGF0dXM6ICdDT01QTEVURUQnLFxuICAgICAgICAgICAgYW1vdW50OiAtZGF0YS5hbW91bnQsIC8vIE5lZ2F0aXZlIGZvciBkZWJpdHNcbiAgICAgICAgICAgIGJhbGFuY2VBZnRlcjogbmV3QmFsYW5jZSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBkYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgZXh0ZXJuYWxJZDogZGF0YS5leHRlcm5hbElkLFxuICAgICAgICAgICAgbWV0YWRhdGE6IGRhdGEubWV0YWRhdGEgPyBKU09OLnN0cmluZ2lmeShkYXRhLm1ldGFkYXRhKSA6IG51bGwsXG4gICAgICAgICAgICBwcm9jZXNzZWRBdDogbmV3IERhdGUoKVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc29sZS5sb2coYOKchSBVU0RUIGRlYml0ZWQgc3VjY2Vzc2Z1bGx5OmAsIHtcbiAgICAgICAgICB1c2VySWQ6IGRhdGEudXNlcklkLFxuICAgICAgICAgIGFtb3VudDogZGF0YS5hbW91bnQsXG4gICAgICAgICAgbmV3QmFsYW5jZTogbmV3QmFsYW5jZSxcbiAgICAgICAgICB0cmFuc2FjdGlvbklkOiB0cmFuc2FjdGlvbi5pZFxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgd2FsbGV0OiB1cGRhdGVkV2FsbGV0LFxuICAgICAgICAgIHRyYW5zYWN0aW9uLFxuICAgICAgICAgIG5ld0JhbGFuY2VcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZWJpdGluZyBVU0RUOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8vIEdldCB3YWxsZXQgYmFsYW5jZVxuICBhc3luYyBnZXRCYWxhbmNlKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTx7IGJhbGFuY2U6IG51bWJlcjsgZnJvemVuQmFsYW5jZTogbnVtYmVyOyB0b3RhbERlcG9zaXRlZDogbnVtYmVyOyB0b3RhbFdpdGhkcmF3bjogbnVtYmVyIH0gfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHdhbGxldCA9IGF3YWl0IHByaXNtYS51U0RUV2FsbGV0LmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQgfVxuICAgICAgfSk7XG5cbiAgICAgIGlmICghd2FsbGV0KSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBiYWxhbmNlOiBOdW1iZXIod2FsbGV0LmJhbGFuY2UpLFxuICAgICAgICBmcm96ZW5CYWxhbmNlOiBOdW1iZXIod2FsbGV0LmZyb3plbkJhbGFuY2UpLFxuICAgICAgICB0b3RhbERlcG9zaXRlZDogTnVtYmVyKHdhbGxldC50b3RhbERlcG9zaXRlZCksXG4gICAgICAgIHRvdGFsV2l0aGRyYXduOiBOdW1iZXIod2FsbGV0LnRvdGFsV2l0aGRyYXduKVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyBiYWxhbmNlOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8vIEdldCB0cmFuc2FjdGlvbiBoaXN0b3J5XG4gIGFzeW5jIGdldFRyYW5zYWN0aW9uSGlzdG9yeSh1c2VySWQ6IHN0cmluZywgbGltaXQgPSA1MCwgb2Zmc2V0ID0gMCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB3YWxsZXQgPSBhd2FpdCB0aGlzLmdldE9yQ3JlYXRlV2FsbGV0KHVzZXJJZCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHRyYW5zYWN0aW9ucyA9IGF3YWl0IHByaXNtYS51U0RUVHJhbnNhY3Rpb24uZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyB3YWxsZXRJZDogd2FsbGV0LmlkIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgdGFrZTogbGltaXQsXG4gICAgICAgIHNraXA6IG9mZnNldFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRyYW5zYWN0aW9uczogdHJhbnNhY3Rpb25zLm1hcCh0eCA9PiAoe1xuICAgICAgICAgIC4uLnR4LFxuICAgICAgICAgIGFtb3VudDogTnVtYmVyKHR4LmFtb3VudCksXG4gICAgICAgICAgYmFsYW5jZUFmdGVyOiB0eC5iYWxhbmNlQWZ0ZXIgPyBOdW1iZXIodHguYmFsYW5jZUFmdGVyKSA6IG51bGwsXG4gICAgICAgICAgYnJsQW1vdW50OiB0eC5icmxBbW91bnQgPyBOdW1iZXIodHguYnJsQW1vdW50KSA6IG51bGwsXG4gICAgICAgICAgZXhjaGFuZ2VSYXRlOiB0eC5leGNoYW5nZVJhdGUgPyBOdW1iZXIodHguZXhjaGFuZ2VSYXRlKSA6IG51bGwsXG4gICAgICAgICAgbWV0YWRhdGE6IHR4Lm1ldGFkYXRhID8gSlNPTi5wYXJzZSh0eC5tZXRhZGF0YSkgOiBudWxsXG4gICAgICAgIH0pKSxcbiAgICAgICAgdG90YWw6IGF3YWl0IHByaXNtYS51U0RUVHJhbnNhY3Rpb24uY291bnQoe1xuICAgICAgICAgIHdoZXJlOiB7IHdhbGxldElkOiB3YWxsZXQuaWQgfVxuICAgICAgICB9KVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyB0cmFuc2FjdGlvbiBoaXN0b3J5OicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8vIENyZWF0ZSBwZW5kaW5nIHRyYW5zYWN0aW9uIChiZWZvcmUgUElYIHBheW1lbnQpXG4gIGFzeW5jIGNyZWF0ZVBlbmRpbmdUcmFuc2FjdGlvbihkYXRhOiBDcmVhdGVUcmFuc2FjdGlvbkRhdGEpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgd2FsbGV0ID0gYXdhaXQgdGhpcy5nZXRPckNyZWF0ZVdhbGxldChkYXRhLnVzZXJJZCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gYXdhaXQgcHJpc21hLnVTRFRUcmFuc2FjdGlvbi5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgd2FsbGV0SWQ6IHdhbGxldC5pZCxcbiAgICAgICAgICB0eXBlOiBkYXRhLnR5cGUsXG4gICAgICAgICAgc3RhdHVzOiAnUEVORElORycsXG4gICAgICAgICAgYW1vdW50OiBkYXRhLmFtb3VudCxcbiAgICAgICAgICBwaXhDb2RlOiBkYXRhLnBpeENvZGUsXG4gICAgICAgICAgcGl4VHJhbnNhY3Rpb25JZDogZGF0YS5waXhUcmFuc2FjdGlvbklkLFxuICAgICAgICAgIGJybEFtb3VudDogZGF0YS5icmxBbW91bnQsXG4gICAgICAgICAgZXhjaGFuZ2VSYXRlOiBkYXRhLmV4Y2hhbmdlUmF0ZSxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogZGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICBleHRlcm5hbElkOiBkYXRhLmV4dGVybmFsSWQsXG4gICAgICAgICAgbWV0YWRhdGE6IGRhdGEubWV0YWRhdGEgPyBKU09OLnN0cmluZ2lmeShkYXRhLm1ldGFkYXRhKSA6IG51bGxcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB0cmFuc2FjdGlvbjtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgcGVuZGluZyB0cmFuc2FjdGlvbjonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvLyBDb21wbGV0ZSBwZW5kaW5nIHRyYW5zYWN0aW9uICh3aGVuIFBJWCBpcyBwYWlkKVxuICBhc3luYyBjb21wbGV0ZVBlbmRpbmdUcmFuc2FjdGlvbihwaXhUcmFuc2FjdGlvbklkOiBzdHJpbmcpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgIC8vIEZpbmQgcGVuZGluZyB0cmFuc2FjdGlvblxuICAgICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IGF3YWl0IHR4LnVTRFRUcmFuc2FjdGlvbi5maW5kRmlyc3Qoe1xuICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICBwaXhUcmFuc2FjdGlvbklkLFxuICAgICAgICAgICAgc3RhdHVzOiAnUEVORElORydcbiAgICAgICAgICB9LFxuICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgIHdhbGxldDogdHJ1ZVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCF0cmFuc2FjdGlvbikge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgUGVuZGluZyB0cmFuc2FjdGlvbiBub3QgZm91bmQgZm9yIFBJWCBJRDogJHtwaXhUcmFuc2FjdGlvbklkfWApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIHdhbGxldCBiYWxhbmNlXG4gICAgICAgIGNvbnN0IG5ld0JhbGFuY2UgPSBOdW1iZXIodHJhbnNhY3Rpb24ud2FsbGV0LmJhbGFuY2UpICsgTnVtYmVyKHRyYW5zYWN0aW9uLmFtb3VudCk7XG4gICAgICAgIGNvbnN0IG5ld1RvdGFsRGVwb3NpdGVkID0gTnVtYmVyKHRyYW5zYWN0aW9uLndhbGxldC50b3RhbERlcG9zaXRlZCkgKyBOdW1iZXIodHJhbnNhY3Rpb24uYW1vdW50KTtcblxuICAgICAgICBhd2FpdCB0eC51U0RUV2FsbGV0LnVwZGF0ZSh7XG4gICAgICAgICAgd2hlcmU6IHsgaWQ6IHRyYW5zYWN0aW9uLndhbGxldElkIH0sXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgYmFsYW5jZTogbmV3QmFsYW5jZSxcbiAgICAgICAgICAgIHRvdGFsRGVwb3NpdGVkOiBuZXdUb3RhbERlcG9zaXRlZFxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gVXBkYXRlIHRyYW5zYWN0aW9uIHN0YXR1c1xuICAgICAgICBjb25zdCBjb21wbGV0ZWRUcmFuc2FjdGlvbiA9IGF3YWl0IHR4LnVTRFRUcmFuc2FjdGlvbi51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkOiB0cmFuc2FjdGlvbi5pZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXR1czogJ0NPTVBMRVRFRCcsXG4gICAgICAgICAgICBiYWxhbmNlQWZ0ZXI6IG5ld0JhbGFuY2UsXG4gICAgICAgICAgICBwcm9jZXNzZWRBdDogbmV3IERhdGUoKVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc29sZS5sb2coYOKchSBUcmFuc2FjdGlvbiBjb21wbGV0ZWQ6YCwge1xuICAgICAgICAgIHRyYW5zYWN0aW9uSWQ6IHRyYW5zYWN0aW9uLmlkLFxuICAgICAgICAgIHBpeFRyYW5zYWN0aW9uSWQsXG4gICAgICAgICAgYW1vdW50OiBOdW1iZXIodHJhbnNhY3Rpb24uYW1vdW50KSxcbiAgICAgICAgICBuZXdCYWxhbmNlXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICB0cmFuc2FjdGlvbjogY29tcGxldGVkVHJhbnNhY3Rpb24sXG4gICAgICAgICAgbmV3QmFsYW5jZVxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNvbXBsZXRpbmcgcGVuZGluZyB0cmFuc2FjdGlvbjonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cbn1cblxuLy8gRXhwb3J0IHNpbmdsZXRvbiBpbnN0YW5jZVxuZXhwb3J0IGNvbnN0IHdhbGxldFNlcnZpY2UgPSBuZXcgV2FsbGV0U2VydmljZSgpOyJdLCJuYW1lcyI6WyJQcmlzbWFDbGllbnQiLCJwcmlzbWEiLCJXYWxsZXRTZXJ2aWNlIiwiZ2V0T3JDcmVhdGVXYWxsZXQiLCJ1c2VySWQiLCJ3YWxsZXQiLCJ1U0RUV2FsbGV0IiwiZmluZFVuaXF1ZSIsIndoZXJlIiwiaW5jbHVkZSIsInVzZXIiLCJzZWxlY3QiLCJpZCIsIm5hbWUiLCJlbWFpbCIsImNyZWF0ZSIsImRhdGEiLCJiYWxhbmNlIiwiZnJvemVuQmFsYW5jZSIsInRvdGFsRGVwb3NpdGVkIiwidG90YWxXaXRoZHJhd24iLCJlcnJvciIsImNvbnNvbGUiLCJjcmVkaXRVU0RUIiwiJHRyYW5zYWN0aW9uIiwidHgiLCJuZXdCYWxhbmNlIiwiTnVtYmVyIiwiYW1vdW50IiwibmV3VG90YWxEZXBvc2l0ZWQiLCJ1cGRhdGVkV2FsbGV0IiwidXBkYXRlIiwidHJhbnNhY3Rpb24iLCJ1U0RUVHJhbnNhY3Rpb24iLCJ3YWxsZXRJZCIsInR5cGUiLCJzdGF0dXMiLCJiYWxhbmNlQWZ0ZXIiLCJwaXhDb2RlIiwicGl4VHJhbnNhY3Rpb25JZCIsImJybEFtb3VudCIsImV4Y2hhbmdlUmF0ZSIsImRlc2NyaXB0aW9uIiwiZXh0ZXJuYWxJZCIsIm1ldGFkYXRhIiwiSlNPTiIsInN0cmluZ2lmeSIsInByb2Nlc3NlZEF0IiwiRGF0ZSIsImxvZyIsInRyYW5zYWN0aW9uSWQiLCJzdWNjZXNzIiwiZGViaXRVU0RUIiwiRXJyb3IiLCJuZXdUb3RhbFdpdGhkcmF3biIsImdldEJhbGFuY2UiLCJnZXRUcmFuc2FjdGlvbkhpc3RvcnkiLCJsaW1pdCIsIm9mZnNldCIsInRyYW5zYWN0aW9ucyIsImZpbmRNYW55Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsInRha2UiLCJza2lwIiwibWFwIiwicGFyc2UiLCJ0b3RhbCIsImNvdW50IiwiY3JlYXRlUGVuZGluZ1RyYW5zYWN0aW9uIiwiY29tcGxldGVQZW5kaW5nVHJhbnNhY3Rpb24iLCJmaW5kRmlyc3QiLCJjb21wbGV0ZWRUcmFuc2FjdGlvbiIsIndhbGxldFNlcnZpY2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/walletService.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/xgate.ts":
/*!**************************!*\
  !*** ./src/lib/xgate.ts ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getXGateService: () => (/* binding */ getXGateService)\n/* harmony export */ });\nclass XGateService {\n    constructor(){\n        this.token = null;\n        this.tokenExpiry = null;\n        this.currencies = [];\n        this.cryptos = [];\n        // Hardcoded for testing - REPLACE IN PRODUCTION\n        this.apiUrl = \"https://api.xgateglobal.com\";\n        this.email = \"felix@elmada.bet\";\n        this.password = \"5D7BSrwDBqoHJIPHD1oLg4w5t8\";\n        this.webhookUrl = \"https://nutzxgate.loca.lt/api/xgate/webhook\";\n        console.log(\"\\uD83D\\uDD27 XGate environment check:\", {\n            apiUrl: this.apiUrl ? \"✅ Set\" : \"❌ Missing\",\n            email: this.email ? \"✅ Set\" : \"❌ Missing\",\n            password: this.password ? \"✅ Set\" : \"❌ Missing\",\n            webhookUrl: this.webhookUrl ? \"✅ Set\" : \"❌ Missing\"\n        });\n        if (!this.apiUrl || !this.email || !this.password) {\n            console.error(\"❌ XGate credentials missing:\", {\n                XGATE_API_URL: process.env.XGATE_API_URL,\n                XGATE_EMAIL: process.env.XGATE_EMAIL ? \"EXISTS\" : \"MISSING\",\n                XGATE_PASSWORD: process.env.XGATE_PASSWORD ? \"EXISTS\" : \"MISSING\",\n                XGATE_WEBHOOK_URL: process.env.XGATE_WEBHOOK_URL\n            });\n            throw new Error(\"XGate credentials not configured\");\n        }\n    }\n    async makeRequest(endpoint, method = \"GET\", data, requireAuth = true) {\n        try {\n            if (requireAuth && !await this.ensureAuthenticated()) {\n                throw new Error(\"Authentication failed\");\n            }\n            const url = `${this.apiUrl}${endpoint}`;\n            const headers = {\n                \"Content-Type\": \"application/json\"\n            };\n            if (requireAuth && this.token) {\n                headers[\"Authorization\"] = `Bearer ${this.token}`;\n            }\n            console.log(`🌐 XGate ${method} ${endpoint}`);\n            const response = await fetch(url, {\n                method,\n                headers,\n                body: data ? JSON.stringify(data) : undefined\n            });\n            const responseData = await response.json();\n            if (!response.ok) {\n                console.error(`❌ XGate API error [${response.status}]:`, responseData);\n                // Handle 401 Unauthorized - token expired\n                if (response.status === 401 && requireAuth) {\n                    console.log(\"\\uD83D\\uDD04 Token expired, re-authenticating...\");\n                    this.token = null;\n                    this.tokenExpiry = null;\n                    if (await this.ensureAuthenticated()) {\n                        // Retry request with new token\n                        headers[\"Authorization\"] = `Bearer ${this.token}`;\n                        const retryResponse = await fetch(url, {\n                            method,\n                            headers,\n                            body: data ? JSON.stringify(data) : undefined\n                        });\n                        return await retryResponse.json();\n                    }\n                }\n                throw new Error(`XGate API error: ${responseData.message || responseData.error || \"Unknown error\"}`);\n            }\n            console.log(\"✅ XGate API response:\", responseData);\n            return responseData;\n        } catch (error) {\n            console.error(\"❌ XGate request failed:\", error);\n            throw error;\n        }\n    }\n    async authenticate() {\n        try {\n            console.log(\"\\uD83D\\uDD10 Authenticating with XGate...\");\n            const response = await this.makeRequest(\"/auth/token\", \"POST\", {\n                email: this.email,\n                password: this.password\n            }, false);\n            if (response.token) {\n                this.token = response.token;\n                // Set token expiry to 23 hours from now (assuming 24h validity)\n                this.tokenExpiry = new Date(Date.now() + 23 * 60 * 60 * 1000);\n                console.log(\"✅ XGate authentication successful\");\n                return {\n                    success: true,\n                    token: response.token\n                };\n            } else {\n                console.error(\"❌ XGate authentication failed - no token received\");\n                return {\n                    success: false,\n                    error: \"No token received\"\n                };\n            }\n        } catch (error) {\n            console.error(\"❌ XGate authentication error:\", error);\n            return {\n                success: false,\n                error: error.message\n            };\n        }\n    }\n    async ensureAuthenticated() {\n        // Check if token exists and is still valid\n        if (this.token && this.tokenExpiry && new Date() < this.tokenExpiry) {\n            return true;\n        }\n        // Authenticate\n        const authResult = await this.authenticate();\n        return authResult.success;\n    }\n    async loadCurrenciesAndCryptos() {\n        try {\n            console.log(\"\\uD83D\\uDCCB Loading XGate currencies and cryptos...\");\n            // Load currencies (BRL/PIX)\n            const currenciesResponse = await this.makeRequest(\"/deposit/company/currencies\");\n            if (currenciesResponse && Array.isArray(currenciesResponse)) {\n                this.currencies = currenciesResponse;\n                console.log(\"✅ Loaded currencies:\", this.currencies.map((c)=>c.symbol));\n            }\n            // Load cryptocurrencies (USDT)\n            const cryptosResponse = await this.makeRequest(\"/deposit/company/cryptocurrencies\");\n            if (cryptosResponse && Array.isArray(cryptosResponse)) {\n                this.cryptos = cryptosResponse;\n                console.log(\"✅ Loaded cryptos:\", this.cryptos.map((c)=>c.symbol));\n            }\n            return this.currencies.length > 0 && this.cryptos.length > 0;\n        } catch (error) {\n            console.error(\"❌ Failed to load currencies/cryptos:\", error);\n            return false;\n        }\n    }\n    getBRLCurrency() {\n        return this.currencies.find((c)=>c.symbol === \"BRL\" || c.type === \"PIX\") || null;\n    }\n    getUSDTCrypto() {\n        return this.cryptos.find((c)=>c.symbol === \"USDT\") || null;\n    }\n    async getQuote(fromAmount) {\n        try {\n            console.log(`💱 Getting USDT quote for ${fromAmount} BRL`);\n            // Try the main conversion endpoint first\n            try {\n                const response = await this.makeRequest(\"/deposit/conversion/tether\", \"POST\", {\n                    amount: fromAmount,\n                    currency: \"BRL\"\n                });\n                if (response && (response.toAmount || response.conversion)) {\n                    const toAmount = response.toAmount || response.conversion?.amount || 0;\n                    const rate = response.rate || response.conversion?.rate || toAmount / fromAmount;\n                    return {\n                        success: true,\n                        data: {\n                            fromAmount: fromAmount,\n                            toAmount: toAmount,\n                            rate: rate,\n                            expires: response.expires || new Date(Date.now() + 15 * 60 * 1000).toISOString()\n                        }\n                    };\n                }\n            } catch (conversionError) {\n                console.warn(\"⚠️ Primary conversion endpoint failed, trying alternatives...\");\n                // Try alternative endpoints or approaches\n                try {\n                    // Try with currency IDs instead\n                    const brlCurrency = this.getBRLCurrency();\n                    const usdtCrypto = this.getUSDTCrypto();\n                    if (brlCurrency && usdtCrypto) {\n                        const altResponse = await this.makeRequest(\"/deposit/conversion\", \"POST\", {\n                            amount: fromAmount,\n                            currency_id: brlCurrency._id || brlCurrency.id,\n                            cryptocurrency_id: usdtCrypto._id || usdtCrypto.id\n                        });\n                        if (altResponse && (altResponse.toAmount || altResponse.conversion)) {\n                            const toAmount = altResponse.toAmount || altResponse.conversion?.amount || 0;\n                            const rate = altResponse.rate || altResponse.conversion?.rate || toAmount / fromAmount;\n                            return {\n                                success: true,\n                                data: {\n                                    fromAmount: fromAmount,\n                                    toAmount: toAmount,\n                                    rate: rate,\n                                    expires: altResponse.expires || new Date(Date.now() + 15 * 60 * 1000).toISOString()\n                                }\n                            };\n                        }\n                    }\n                } catch (altError) {\n                    console.warn(\"⚠️ Alternative conversion endpoint also failed:\", altError);\n                }\n                // Re-throw original error\n                throw conversionError;\n            }\n            return {\n                success: false,\n                error: \"Invalid quote response\"\n            };\n        } catch (error) {\n            console.error(\"❌ Quote request failed:\", error);\n            return {\n                success: false,\n                error: error.message\n            };\n        }\n    }\n    async createOrGetCustomer(name, email, document) {\n        try {\n            console.log(`👤 Creating/getting customer: ${email}`);\n            const response = await this.makeRequest(\"/customer\", \"POST\", {\n                name: name,\n                email: email,\n                document: document.replace(/\\D/g, \"\"),\n                type: document.length > 11 ? \"CNPJ\" : \"CPF\"\n            });\n            if (response && (response.id || response.customer?._id)) {\n                const customerId = response.id || response.customer._id;\n                console.log(\"✅ Customer created/found:\", customerId);\n                return customerId;\n            } else {\n                console.error(\"❌ Failed to create customer:\", response);\n                return null;\n            }\n        } catch (error) {\n            console.error(\"❌ Customer creation failed:\", error);\n            return null;\n        }\n    }\n    async createDeposit(depositData) {\n        try {\n            console.log(\"\\uD83D\\uDCB0 Creating XGate deposit:\", depositData);\n            // Get the full currency and crypto objects\n            const brlCurrency = this.getBRLCurrency();\n            const usdtCrypto = this.getUSDTCrypto();\n            if (!brlCurrency || !usdtCrypto) {\n                throw new Error(\"Currency or cryptocurrency not available\");\n            }\n            const requestPayload = {\n                amount: depositData.amount,\n                customerId: depositData.customerId,\n                currency: {\n                    _id: brlCurrency._id,\n                    name: brlCurrency.name,\n                    type: brlCurrency.type,\n                    symbol: brlCurrency.symbol\n                },\n                cryptocurrency: {\n                    _id: usdtCrypto._id,\n                    name: usdtCrypto.name,\n                    symbol: usdtCrypto.symbol,\n                    coinGecko: usdtCrypto.coinGecko || \"tether\"\n                },\n                webhookUrl: \"https://nutzxgate.loca.lt/api/xgate/webhook\"\n            };\n            console.log(\"\\uD83D\\uDCE4 Sending deposit request:\", JSON.stringify(requestPayload, null, 2));\n            const response = await this.makeRequest(\"/deposit\", \"POST\", requestPayload);\n            if (response && (response.id || response.data?.id)) {\n                // Handle different response formats\n                const depositData = response.data || response;\n                return {\n                    success: true,\n                    data: {\n                        id: depositData.id || response.id,\n                        pixCode: depositData.code || depositData.pix_code || depositData.pixCode,\n                        status: depositData.status || \"WAITING_PAYMENT\",\n                        amount: depositData.amount || depositData.amount,\n                        cryptoAmount: depositData.crypto_amount || depositData.cryptoAmount,\n                        expiresAt: depositData.expires_at || depositData.expiresAt,\n                        qrCodeUrl: depositData.qr_code_url || null\n                    }\n                };\n            } else {\n                return {\n                    success: false,\n                    error: \"Invalid deposit response\"\n                };\n            }\n        } catch (error) {\n            console.error(\"❌ Deposit creation failed:\", error);\n            return {\n                success: false,\n                error: error.message\n            };\n        }\n    }\n}\n// Singleton instance\nlet xgateService = null;\nfunction getXGateService() {\n    if (!xgateService) {\n        xgateService = new XGateService();\n    }\n    return xgateService;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TztnQkFBRStCLFNBQVM7Z0JBQU8vQixPQUFPLE1BQWlCMkIsT0FBTztZQUFDO1FBQzNEO0lBQ0Y7QUFDRjtBQUVBLHFCQUFxQjtBQUNyQixJQUFJMEQsZUFBb0M7QUFFakMsU0FBU0M7SUFDZCxJQUFJLENBQUNELGNBQWM7UUFDakJBLGVBQWUsSUFBSWpHO0lBQ3JCO0lBQ0EsT0FBT2lHO0FBQ1QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AbnV0emJldGEvd2ViLy4vc3JjL2xpYi94Z2F0ZS50cz83ZmExIl0sInNvdXJjZXNDb250ZW50IjpbImludGVyZmFjZSBYR2F0ZUF1dGhSZXNwb25zZSB7XG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIHRva2VuPzogc3RyaW5nO1xuICBlcnJvcj86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIFhHYXRlQ3VycmVuY3kge1xuICBfaWQ6IHN0cmluZztcbiAgaWQ/OiBzdHJpbmc7XG4gIG5hbWU6IHN0cmluZztcbiAgc3ltYm9sOiBzdHJpbmc7XG4gIHR5cGU6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIFhHYXRlQ3J5cHRvIHtcbiAgX2lkOiBzdHJpbmc7XG4gIGlkPzogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG4gIHN5bWJvbDogc3RyaW5nO1xuICBuZXR3b3JrPzogc3RyaW5nO1xuICBjb2luR2Vja28/OiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBYR2F0ZUN1c3RvbWVyIHtcbiAgaWQ6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBlbWFpbDogc3RyaW5nO1xuICBkb2N1bWVudDogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgWEdhdGVRdW90ZVJlc3BvbnNlIHtcbiAgc3VjY2VzczogYm9vbGVhbjtcbiAgZGF0YT86IHtcbiAgICBmcm9tQW1vdW50OiBudW1iZXI7XG4gICAgdG9BbW91bnQ6IG51bWJlcjtcbiAgICByYXRlOiBudW1iZXI7XG4gICAgZXhwaXJlczogc3RyaW5nO1xuICB9O1xuICBlcnJvcj86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIFhHYXRlRGVwb3NpdFJlc3BvbnNlIHtcbiAgc3VjY2VzczogYm9vbGVhbjtcbiAgZGF0YT86IHtcbiAgICBpZDogc3RyaW5nO1xuICAgIHBpeENvZGU6IHN0cmluZztcbiAgICBzdGF0dXM6IHN0cmluZztcbiAgICBhbW91bnQ6IG51bWJlcjtcbiAgICBjcnlwdG9BbW91bnQ6IG51bWJlcjtcbiAgICBleHBpcmVzQXQ6IHN0cmluZztcbiAgICBxckNvZGVVcmw/OiBzdHJpbmc7XG4gIH07XG4gIGVycm9yPzogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgWEdhdGVEZXBvc2l0UmVxdWVzdCB7XG4gIGN1c3RvbWVySWQ6IHN0cmluZztcbiAgY3VycmVuY3lJZDogc3RyaW5nO1xuICBjcnlwdG9JZDogc3RyaW5nO1xuICBhbW91bnQ6IG51bWJlcjtcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgd2ViaG9va1VybDogc3RyaW5nO1xufVxuXG5jbGFzcyBYR2F0ZVNlcnZpY2Uge1xuICBwcml2YXRlIHRva2VuOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSB0b2tlbkV4cGlyeTogRGF0ZSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGN1cnJlbmNpZXM6IFhHYXRlQ3VycmVuY3lbXSA9IFtdO1xuICBwcml2YXRlIGNyeXB0b3M6IFhHYXRlQ3J5cHRvW10gPSBbXTtcbiAgXG4gIHByaXZhdGUgcmVhZG9ubHkgYXBpVXJsOiBzdHJpbmc7XG4gIHByaXZhdGUgcmVhZG9ubHkgZW1haWw6IHN0cmluZztcbiAgcHJpdmF0ZSByZWFkb25seSBwYXNzd29yZDogc3RyaW5nO1xuICBwcml2YXRlIHJlYWRvbmx5IHdlYmhvb2tVcmw6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICAvLyBIYXJkY29kZWQgZm9yIHRlc3RpbmcgLSBSRVBMQUNFIElOIFBST0RVQ1RJT05cbiAgICB0aGlzLmFwaVVybCA9ICdodHRwczovL2FwaS54Z2F0ZWdsb2JhbC5jb20nO1xuICAgIHRoaXMuZW1haWwgPSAnZmVsaXhAZWxtYWRhLmJldCc7XG4gICAgdGhpcy5wYXNzd29yZCA9ICc1RDdCU3J3REJxb0hKSVBIRDFvTGc0dzV0OCc7XG4gICAgdGhpcy53ZWJob29rVXJsID0gJ2h0dHBzOi8vbnV0enhnYXRlLmxvY2EubHQvYXBpL3hnYXRlL3dlYmhvb2snO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKCfwn5SnIFhHYXRlIGVudmlyb25tZW50IGNoZWNrOicsIHtcbiAgICAgIGFwaVVybDogdGhpcy5hcGlVcmwgPyAn4pyFIFNldCcgOiAn4p2MIE1pc3NpbmcnLFxuICAgICAgZW1haWw6IHRoaXMuZW1haWwgPyAn4pyFIFNldCcgOiAn4p2MIE1pc3NpbmcnLFxuICAgICAgcGFzc3dvcmQ6IHRoaXMucGFzc3dvcmQgPyAn4pyFIFNldCcgOiAn4p2MIE1pc3NpbmcnLFxuICAgICAgd2ViaG9va1VybDogdGhpcy53ZWJob29rVXJsID8gJ+KchSBTZXQnIDogJ+KdjCBNaXNzaW5nJ1xuICAgIH0pO1xuICAgIFxuICAgIGlmICghdGhpcy5hcGlVcmwgfHwgIXRoaXMuZW1haWwgfHwgIXRoaXMucGFzc3dvcmQpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBYR2F0ZSBjcmVkZW50aWFscyBtaXNzaW5nOicsIHtcbiAgICAgICAgWEdBVEVfQVBJX1VSTDogcHJvY2Vzcy5lbnYuWEdBVEVfQVBJX1VSTCxcbiAgICAgICAgWEdBVEVfRU1BSUw6IHByb2Nlc3MuZW52LlhHQVRFX0VNQUlMID8gJ0VYSVNUUycgOiAnTUlTU0lORycsXG4gICAgICAgIFhHQVRFX1BBU1NXT1JEOiBwcm9jZXNzLmVudi5YR0FURV9QQVNTV09SRCA/ICdFWElTVFMnIDogJ01JU1NJTkcnLFxuICAgICAgICBYR0FURV9XRUJIT09LX1VSTDogcHJvY2Vzcy5lbnYuWEdBVEVfV0VCSE9PS19VUkxcbiAgICAgIH0pO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdYR2F0ZSBjcmVkZW50aWFscyBub3QgY29uZmlndXJlZCcpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgbWFrZVJlcXVlc3QoXG4gICAgZW5kcG9pbnQ6IHN0cmluZywgXG4gICAgbWV0aG9kOiAnR0VUJyB8ICdQT1NUJyA9ICdHRVQnLCBcbiAgICBkYXRhPzogYW55LFxuICAgIHJlcXVpcmVBdXRoOiBib29sZWFuID0gdHJ1ZVxuICApOiBQcm9taXNlPGFueT4ge1xuICAgIHRyeSB7XG4gICAgICBpZiAocmVxdWlyZUF1dGggJiYgIShhd2FpdCB0aGlzLmVuc3VyZUF1dGhlbnRpY2F0ZWQoKSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBdXRoZW50aWNhdGlvbiBmYWlsZWQnKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdXJsID0gYCR7dGhpcy5hcGlVcmx9JHtlbmRwb2ludH1gO1xuICAgICAgY29uc3QgaGVhZGVyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgIH07XG5cbiAgICAgIGlmIChyZXF1aXJlQXV0aCAmJiB0aGlzLnRva2VuKSB7XG4gICAgICAgIGhlYWRlcnNbJ0F1dGhvcml6YXRpb24nXSA9IGBCZWFyZXIgJHt0aGlzLnRva2VufWA7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKGDwn4yQIFhHYXRlICR7bWV0aG9kfSAke2VuZHBvaW50fWApO1xuICAgICAgXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwge1xuICAgICAgICBtZXRob2QsXG4gICAgICAgIGhlYWRlcnMsXG4gICAgICAgIGJvZHk6IGRhdGEgPyBKU09OLnN0cmluZ2lmeShkYXRhKSA6IHVuZGVmaW5lZCxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXNwb25zZURhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG5cbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihg4p2MIFhHYXRlIEFQSSBlcnJvciBbJHtyZXNwb25zZS5zdGF0dXN9XTpgLCByZXNwb25zZURhdGEpO1xuICAgICAgICBcbiAgICAgICAgLy8gSGFuZGxlIDQwMSBVbmF1dGhvcml6ZWQgLSB0b2tlbiBleHBpcmVkXG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMSAmJiByZXF1aXJlQXV0aCkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5SEIFRva2VuIGV4cGlyZWQsIHJlLWF1dGhlbnRpY2F0aW5nLi4uJyk7XG4gICAgICAgICAgdGhpcy50b2tlbiA9IG51bGw7XG4gICAgICAgICAgdGhpcy50b2tlbkV4cGlyeSA9IG51bGw7XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKGF3YWl0IHRoaXMuZW5zdXJlQXV0aGVudGljYXRlZCgpKSB7XG4gICAgICAgICAgICAvLyBSZXRyeSByZXF1ZXN0IHdpdGggbmV3IHRva2VuXG4gICAgICAgICAgICBoZWFkZXJzWydBdXRob3JpemF0aW9uJ10gPSBgQmVhcmVyICR7dGhpcy50b2tlbn1gO1xuICAgICAgICAgICAgY29uc3QgcmV0cnlSZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwge1xuICAgICAgICAgICAgICBtZXRob2QsXG4gICAgICAgICAgICAgIGhlYWRlcnMsXG4gICAgICAgICAgICAgIGJvZHk6IGRhdGEgPyBKU09OLnN0cmluZ2lmeShkYXRhKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHJ5UmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBYR2F0ZSBBUEkgZXJyb3I6ICR7cmVzcG9uc2VEYXRhLm1lc3NhZ2UgfHwgcmVzcG9uc2VEYXRhLmVycm9yIHx8ICdVbmtub3duIGVycm9yJ31gKTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coJ+KchSBYR2F0ZSBBUEkgcmVzcG9uc2U6JywgcmVzcG9uc2VEYXRhKTtcbiAgICAgIHJldHVybiByZXNwb25zZURhdGE7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIFhHYXRlIHJlcXVlc3QgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgYXV0aGVudGljYXRlKCk6IFByb21pc2U8WEdhdGVBdXRoUmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coJ/CflJAgQXV0aGVudGljYXRpbmcgd2l0aCBYR2F0ZS4uLicpO1xuICAgICAgXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMubWFrZVJlcXVlc3QoJy9hdXRoL3Rva2VuJywgJ1BPU1QnLCB7XG4gICAgICAgIGVtYWlsOiB0aGlzLmVtYWlsLFxuICAgICAgICBwYXNzd29yZDogdGhpcy5wYXNzd29yZFxuICAgICAgfSwgZmFsc2UpO1xuXG4gICAgICBpZiAocmVzcG9uc2UudG9rZW4pIHtcbiAgICAgICAgdGhpcy50b2tlbiA9IHJlc3BvbnNlLnRva2VuO1xuICAgICAgICAvLyBTZXQgdG9rZW4gZXhwaXJ5IHRvIDIzIGhvdXJzIGZyb20gbm93IChhc3N1bWluZyAyNGggdmFsaWRpdHkpXG4gICAgICAgIHRoaXMudG9rZW5FeHBpcnkgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgMjMgKiA2MCAqIDYwICogMTAwMCk7XG4gICAgICAgIFxuICAgICAgICBjb25zb2xlLmxvZygn4pyFIFhHYXRlIGF1dGhlbnRpY2F0aW9uIHN1Y2Nlc3NmdWwnKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdG9rZW46IHJlc3BvbnNlLnRva2VuIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgWEdhdGUgYXV0aGVudGljYXRpb24gZmFpbGVkIC0gbm8gdG9rZW4gcmVjZWl2ZWQnKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTm8gdG9rZW4gcmVjZWl2ZWQnIH07XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBYR2F0ZSBhdXRoZW50aWNhdGlvbiBlcnJvcjonLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IChlcnJvciBhcyBFcnJvcikubWVzc2FnZSB9O1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZW5zdXJlQXV0aGVudGljYXRlZCgpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAvLyBDaGVjayBpZiB0b2tlbiBleGlzdHMgYW5kIGlzIHN0aWxsIHZhbGlkXG4gICAgaWYgKHRoaXMudG9rZW4gJiYgdGhpcy50b2tlbkV4cGlyeSAmJiBuZXcgRGF0ZSgpIDwgdGhpcy50b2tlbkV4cGlyeSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLy8gQXV0aGVudGljYXRlXG4gICAgY29uc3QgYXV0aFJlc3VsdCA9IGF3YWl0IHRoaXMuYXV0aGVudGljYXRlKCk7XG4gICAgcmV0dXJuIGF1dGhSZXN1bHQuc3VjY2VzcztcbiAgfVxuXG4gIGFzeW5jIGxvYWRDdXJyZW5jaWVzQW5kQ3J5cHRvcygpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coJ/Cfk4sgTG9hZGluZyBYR2F0ZSBjdXJyZW5jaWVzIGFuZCBjcnlwdG9zLi4uJyk7XG4gICAgICBcbiAgICAgIC8vIExvYWQgY3VycmVuY2llcyAoQlJML1BJWClcbiAgICAgIGNvbnN0IGN1cnJlbmNpZXNSZXNwb25zZSA9IGF3YWl0IHRoaXMubWFrZVJlcXVlc3QoJy9kZXBvc2l0L2NvbXBhbnkvY3VycmVuY2llcycpO1xuICAgICAgaWYgKGN1cnJlbmNpZXNSZXNwb25zZSAmJiBBcnJheS5pc0FycmF5KGN1cnJlbmNpZXNSZXNwb25zZSkpIHtcbiAgICAgICAgdGhpcy5jdXJyZW5jaWVzID0gY3VycmVuY2llc1Jlc3BvbnNlO1xuICAgICAgICBjb25zb2xlLmxvZygn4pyFIExvYWRlZCBjdXJyZW5jaWVzOicsIHRoaXMuY3VycmVuY2llcy5tYXAoYyA9PiBjLnN5bWJvbCkpO1xuICAgICAgfVxuXG4gICAgICAvLyBMb2FkIGNyeXB0b2N1cnJlbmNpZXMgKFVTRFQpXG4gICAgICBjb25zdCBjcnlwdG9zUmVzcG9uc2UgPSBhd2FpdCB0aGlzLm1ha2VSZXF1ZXN0KCcvZGVwb3NpdC9jb21wYW55L2NyeXB0b2N1cnJlbmNpZXMnKTtcbiAgICAgIGlmIChjcnlwdG9zUmVzcG9uc2UgJiYgQXJyYXkuaXNBcnJheShjcnlwdG9zUmVzcG9uc2UpKSB7XG4gICAgICAgIHRoaXMuY3J5cHRvcyA9IGNyeXB0b3NSZXNwb25zZTtcbiAgICAgICAgY29uc29sZS5sb2coJ+KchSBMb2FkZWQgY3J5cHRvczonLCB0aGlzLmNyeXB0b3MubWFwKGMgPT4gYy5zeW1ib2wpKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuY3VycmVuY2llcy5sZW5ndGggPiAwICYmIHRoaXMuY3J5cHRvcy5sZW5ndGggPiAwO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRmFpbGVkIHRvIGxvYWQgY3VycmVuY2llcy9jcnlwdG9zOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBnZXRCUkxDdXJyZW5jeSgpOiBYR2F0ZUN1cnJlbmN5IHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVuY2llcy5maW5kKGMgPT4gYy5zeW1ib2wgPT09ICdCUkwnIHx8IGMudHlwZSA9PT0gJ1BJWCcpIHx8IG51bGw7XG4gIH1cblxuICBnZXRVU0RUQ3J5cHRvKCk6IFhHYXRlQ3J5cHRvIHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMuY3J5cHRvcy5maW5kKGMgPT4gYy5zeW1ib2wgPT09ICdVU0RUJykgfHwgbnVsbDtcbiAgfVxuXG4gIGFzeW5jIGdldFF1b3RlKGZyb21BbW91bnQ6IG51bWJlcik6IFByb21pc2U8WEdhdGVRdW90ZVJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKGDwn5KxIEdldHRpbmcgVVNEVCBxdW90ZSBmb3IgJHtmcm9tQW1vdW50fSBCUkxgKTtcbiAgICAgIFxuICAgICAgLy8gVHJ5IHRoZSBtYWluIGNvbnZlcnNpb24gZW5kcG9pbnQgZmlyc3RcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5tYWtlUmVxdWVzdCgnL2RlcG9zaXQvY29udmVyc2lvbi90ZXRoZXInLCAnUE9TVCcsIHtcbiAgICAgICAgICBhbW91bnQ6IGZyb21BbW91bnQsXG4gICAgICAgICAgY3VycmVuY3k6ICdCUkwnXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChyZXNwb25zZSAmJiAocmVzcG9uc2UudG9BbW91bnQgfHwgcmVzcG9uc2UuY29udmVyc2lvbikpIHtcbiAgICAgICAgICBjb25zdCB0b0Ftb3VudCA9IHJlc3BvbnNlLnRvQW1vdW50IHx8IHJlc3BvbnNlLmNvbnZlcnNpb24/LmFtb3VudCB8fCAwO1xuICAgICAgICAgIGNvbnN0IHJhdGUgPSByZXNwb25zZS5yYXRlIHx8IHJlc3BvbnNlLmNvbnZlcnNpb24/LnJhdGUgfHwgKHRvQW1vdW50IC8gZnJvbUFtb3VudCk7XG4gICAgICAgICAgXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIGZyb21BbW91bnQ6IGZyb21BbW91bnQsXG4gICAgICAgICAgICAgIHRvQW1vdW50OiB0b0Ftb3VudCxcbiAgICAgICAgICAgICAgcmF0ZTogcmF0ZSxcbiAgICAgICAgICAgICAgZXhwaXJlczogcmVzcG9uc2UuZXhwaXJlcyB8fCBuZXcgRGF0ZShEYXRlLm5vdygpICsgMTUgKiA2MCAqIDEwMDApLnRvSVNPU3RyaW5nKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChjb252ZXJzaW9uRXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gUHJpbWFyeSBjb252ZXJzaW9uIGVuZHBvaW50IGZhaWxlZCwgdHJ5aW5nIGFsdGVybmF0aXZlcy4uLicpO1xuICAgICAgICBcbiAgICAgICAgLy8gVHJ5IGFsdGVybmF0aXZlIGVuZHBvaW50cyBvciBhcHByb2FjaGVzXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLy8gVHJ5IHdpdGggY3VycmVuY3kgSURzIGluc3RlYWRcbiAgICAgICAgICBjb25zdCBicmxDdXJyZW5jeSA9IHRoaXMuZ2V0QlJMQ3VycmVuY3koKTtcbiAgICAgICAgICBjb25zdCB1c2R0Q3J5cHRvID0gdGhpcy5nZXRVU0RUQ3J5cHRvKCk7XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKGJybEN1cnJlbmN5ICYmIHVzZHRDcnlwdG8pIHtcbiAgICAgICAgICAgIGNvbnN0IGFsdFJlc3BvbnNlID0gYXdhaXQgdGhpcy5tYWtlUmVxdWVzdCgnL2RlcG9zaXQvY29udmVyc2lvbicsICdQT1NUJywge1xuICAgICAgICAgICAgICBhbW91bnQ6IGZyb21BbW91bnQsXG4gICAgICAgICAgICAgIGN1cnJlbmN5X2lkOiBicmxDdXJyZW5jeS5faWQgfHwgYnJsQ3VycmVuY3kuaWQsXG4gICAgICAgICAgICAgIGNyeXB0b2N1cnJlbmN5X2lkOiB1c2R0Q3J5cHRvLl9pZCB8fCB1c2R0Q3J5cHRvLmlkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKGFsdFJlc3BvbnNlICYmIChhbHRSZXNwb25zZS50b0Ftb3VudCB8fCBhbHRSZXNwb25zZS5jb252ZXJzaW9uKSkge1xuICAgICAgICAgICAgICBjb25zdCB0b0Ftb3VudCA9IGFsdFJlc3BvbnNlLnRvQW1vdW50IHx8IGFsdFJlc3BvbnNlLmNvbnZlcnNpb24/LmFtb3VudCB8fCAwO1xuICAgICAgICAgICAgICBjb25zdCByYXRlID0gYWx0UmVzcG9uc2UucmF0ZSB8fCBhbHRSZXNwb25zZS5jb252ZXJzaW9uPy5yYXRlIHx8ICh0b0Ftb3VudCAvIGZyb21BbW91bnQpO1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgIGZyb21BbW91bnQ6IGZyb21BbW91bnQsXG4gICAgICAgICAgICAgICAgICB0b0Ftb3VudDogdG9BbW91bnQsXG4gICAgICAgICAgICAgICAgICByYXRlOiByYXRlLFxuICAgICAgICAgICAgICAgICAgZXhwaXJlczogYWx0UmVzcG9uc2UuZXhwaXJlcyB8fCBuZXcgRGF0ZShEYXRlLm5vdygpICsgMTUgKiA2MCAqIDEwMDApLnRvSVNPU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChhbHRFcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUud2Fybign4pqg77iPIEFsdGVybmF0aXZlIGNvbnZlcnNpb24gZW5kcG9pbnQgYWxzbyBmYWlsZWQ6JywgYWx0RXJyb3IpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBSZS10aHJvdyBvcmlnaW5hbCBlcnJvclxuICAgICAgICB0aHJvdyBjb252ZXJzaW9uRXJyb3I7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgcXVvdGUgcmVzcG9uc2UnIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBRdW90ZSByZXF1ZXN0IGZhaWxlZDonLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IChlcnJvciBhcyBFcnJvcikubWVzc2FnZSB9O1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZU9yR2V0Q3VzdG9tZXIobmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBkb2N1bWVudDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKGDwn5GkIENyZWF0aW5nL2dldHRpbmcgY3VzdG9tZXI6ICR7ZW1haWx9YCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5tYWtlUmVxdWVzdCgnL2N1c3RvbWVyJywgJ1BPU1QnLCB7XG4gICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgIGVtYWlsOiBlbWFpbCxcbiAgICAgICAgZG9jdW1lbnQ6IGRvY3VtZW50LnJlcGxhY2UoL1xcRC9nLCAnJyksIC8vIFJlbW92ZSBmb3JtYXR0aW5nXG4gICAgICAgIHR5cGU6IGRvY3VtZW50Lmxlbmd0aCA+IDExID8gJ0NOUEonIDogJ0NQRidcbiAgICAgIH0pO1xuXG4gICAgICBpZiAocmVzcG9uc2UgJiYgKHJlc3BvbnNlLmlkIHx8IHJlc3BvbnNlLmN1c3RvbWVyPy5faWQpKSB7XG4gICAgICAgIGNvbnN0IGN1c3RvbWVySWQgPSByZXNwb25zZS5pZCB8fCByZXNwb25zZS5jdXN0b21lci5faWQ7XG4gICAgICAgIGNvbnNvbGUubG9nKCfinIUgQ3VzdG9tZXIgY3JlYXRlZC9mb3VuZDonLCBjdXN0b21lcklkKTtcbiAgICAgICAgcmV0dXJuIGN1c3RvbWVySWQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRmFpbGVkIHRvIGNyZWF0ZSBjdXN0b21lcjonLCByZXNwb25zZSk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgQ3VzdG9tZXIgY3JlYXRpb24gZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZURlcG9zaXQoZGVwb3NpdERhdGE6IFhHYXRlRGVwb3NpdFJlcXVlc3QpOiBQcm9taXNlPFhHYXRlRGVwb3NpdFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5KwIENyZWF0aW5nIFhHYXRlIGRlcG9zaXQ6JywgZGVwb3NpdERhdGEpO1xuICAgICAgXG4gICAgICAvLyBHZXQgdGhlIGZ1bGwgY3VycmVuY3kgYW5kIGNyeXB0byBvYmplY3RzXG4gICAgICBjb25zdCBicmxDdXJyZW5jeSA9IHRoaXMuZ2V0QlJMQ3VycmVuY3koKTtcbiAgICAgIGNvbnN0IHVzZHRDcnlwdG8gPSB0aGlzLmdldFVTRFRDcnlwdG8oKTtcbiAgICAgIFxuICAgICAgaWYgKCFicmxDdXJyZW5jeSB8fCAhdXNkdENyeXB0bykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0N1cnJlbmN5IG9yIGNyeXB0b2N1cnJlbmN5IG5vdCBhdmFpbGFibGUnKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc3QgcmVxdWVzdFBheWxvYWQgPSB7XG4gICAgICAgIGFtb3VudDogZGVwb3NpdERhdGEuYW1vdW50LFxuICAgICAgICBjdXN0b21lcklkOiBkZXBvc2l0RGF0YS5jdXN0b21lcklkLFxuICAgICAgICBjdXJyZW5jeToge1xuICAgICAgICAgIF9pZDogYnJsQ3VycmVuY3kuX2lkLFxuICAgICAgICAgIG5hbWU6IGJybEN1cnJlbmN5Lm5hbWUsXG4gICAgICAgICAgdHlwZTogYnJsQ3VycmVuY3kudHlwZSxcbiAgICAgICAgICBzeW1ib2w6IGJybEN1cnJlbmN5LnN5bWJvbFxuICAgICAgICB9LFxuICAgICAgICBjcnlwdG9jdXJyZW5jeToge1xuICAgICAgICAgIF9pZDogdXNkdENyeXB0by5faWQsXG4gICAgICAgICAgbmFtZTogdXNkdENyeXB0by5uYW1lLFxuICAgICAgICAgIHN5bWJvbDogdXNkdENyeXB0by5zeW1ib2wsXG4gICAgICAgICAgY29pbkdlY2tvOiB1c2R0Q3J5cHRvLmNvaW5HZWNrbyB8fCBcInRldGhlclwiXG4gICAgICAgIH0sXG4gICAgICAgIHdlYmhvb2tVcmw6ICdodHRwczovL251dHp4Z2F0ZS5sb2NhLmx0L2FwaS94Z2F0ZS93ZWJob29rJ1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ/Cfk6QgU2VuZGluZyBkZXBvc2l0IHJlcXVlc3Q6JywgSlNPTi5zdHJpbmdpZnkocmVxdWVzdFBheWxvYWQsIG51bGwsIDIpKTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLm1ha2VSZXF1ZXN0KCcvZGVwb3NpdCcsICdQT1NUJywgcmVxdWVzdFBheWxvYWQpO1xuXG4gICAgICBpZiAocmVzcG9uc2UgJiYgKHJlc3BvbnNlLmlkIHx8IHJlc3BvbnNlLmRhdGE/LmlkKSkge1xuICAgICAgICAvLyBIYW5kbGUgZGlmZmVyZW50IHJlc3BvbnNlIGZvcm1hdHNcbiAgICAgICAgY29uc3QgZGVwb3NpdERhdGEgPSByZXNwb25zZS5kYXRhIHx8IHJlc3BvbnNlO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBkZXBvc2l0RGF0YS5pZCB8fCByZXNwb25zZS5pZCxcbiAgICAgICAgICAgIHBpeENvZGU6IGRlcG9zaXREYXRhLmNvZGUgfHwgZGVwb3NpdERhdGEucGl4X2NvZGUgfHwgZGVwb3NpdERhdGEucGl4Q29kZSxcbiAgICAgICAgICAgIHN0YXR1czogZGVwb3NpdERhdGEuc3RhdHVzIHx8ICdXQUlUSU5HX1BBWU1FTlQnLFxuICAgICAgICAgICAgYW1vdW50OiBkZXBvc2l0RGF0YS5hbW91bnQgfHwgZGVwb3NpdERhdGEuYW1vdW50LFxuICAgICAgICAgICAgY3J5cHRvQW1vdW50OiBkZXBvc2l0RGF0YS5jcnlwdG9fYW1vdW50IHx8IGRlcG9zaXREYXRhLmNyeXB0b0Ftb3VudCxcbiAgICAgICAgICAgIGV4cGlyZXNBdDogZGVwb3NpdERhdGEuZXhwaXJlc19hdCB8fCBkZXBvc2l0RGF0YS5leHBpcmVzQXQsXG4gICAgICAgICAgICBxckNvZGVVcmw6IGRlcG9zaXREYXRhLnFyX2NvZGVfdXJsIHx8IG51bGxcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdJbnZhbGlkIGRlcG9zaXQgcmVzcG9uc2UnIH07XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBEZXBvc2l0IGNyZWF0aW9uIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IChlcnJvciBhcyBFcnJvcikubWVzc2FnZSB9O1xuICAgIH1cbiAgfVxufVxuXG4vLyBTaW5nbGV0b24gaW5zdGFuY2VcbmxldCB4Z2F0ZVNlcnZpY2U6IFhHYXRlU2VydmljZSB8IG51bGwgPSBudWxsO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0WEdhdGVTZXJ2aWNlKCk6IFhHYXRlU2VydmljZSB7XG4gIGlmICgheGdhdGVTZXJ2aWNlKSB7XG4gICAgeGdhdGVTZXJ2aWNlID0gbmV3IFhHYXRlU2VydmljZSgpO1xuICB9XG4gIHJldHVybiB4Z2F0ZVNlcnZpY2U7XG59XG5cbmV4cG9ydCB0eXBlIHsgXG4gIFhHYXRlQXV0aFJlc3BvbnNlLCBcbiAgWEdhdGVDdXJyZW5jeSwgXG4gIFhHYXRlQ3J5cHRvLCBcbiAgWEdhdGVDdXN0b21lciwgXG4gIFhHYXRlUXVvdGVSZXNwb25zZSwgXG4gIFhHYXRlRGVwb3NpdFJlc3BvbnNlLFxuICBYR2F0ZURlcG9zaXRSZXF1ZXN0IFxufTsiXSwibmFtZXMiOlsiWEdhdGVTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJ0b2tlbiIsInRva2VuRXhwaXJ5IiwiY3VycmVuY2llcyIsImNyeXB0b3MiLCJhcGlVcmwiLCJlbWFpbCIsInBhc3N3b3JkIiwid2ViaG9va1VybCIsImNvbnNvbGUiLCJsb2ciLCJlcnJvciIsIlhHQVRFX0FQSV9VUkwiLCJwcm9jZXNzIiwiZW52IiwiWEdBVEVfRU1BSUwiLCJYR0FURV9QQVNTV09SRCIsIlhHQVRFX1dFQkhPT0tfVVJMIiwiRXJyb3IiLCJtYWtlUmVxdWVzdCIsImVuZHBvaW50IiwibWV0aG9kIiwiZGF0YSIsInJlcXVpcmVBdXRoIiwiZW5zdXJlQXV0aGVudGljYXRlZCIsInVybCIsImhlYWRlcnMiLCJyZXNwb25zZSIsImZldGNoIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ1bmRlZmluZWQiLCJyZXNwb25zZURhdGEiLCJqc29uIiwib2siLCJzdGF0dXMiLCJyZXRyeVJlc3BvbnNlIiwibWVzc2FnZSIsImF1dGhlbnRpY2F0ZSIsIkRhdGUiLCJub3ciLCJzdWNjZXNzIiwiYXV0aFJlc3VsdCIsImxvYWRDdXJyZW5jaWVzQW5kQ3J5cHRvcyIsImN1cnJlbmNpZXNSZXNwb25zZSIsIkFycmF5IiwiaXNBcnJheSIsIm1hcCIsImMiLCJzeW1ib2wiLCJjcnlwdG9zUmVzcG9uc2UiLCJsZW5ndGgiLCJnZXRCUkxDdXJyZW5jeSIsImZpbmQiLCJ0eXBlIiwiZ2V0VVNEVENyeXB0byIsImdldFF1b3RlIiwiZnJvbUFtb3VudCIsImFtb3VudCIsImN1cnJlbmN5IiwidG9BbW91bnQiLCJjb252ZXJzaW9uIiwicmF0ZSIsImV4cGlyZXMiLCJ0b0lTT1N0cmluZyIsImNvbnZlcnNpb25FcnJvciIsIndhcm4iLCJicmxDdXJyZW5jeSIsInVzZHRDcnlwdG8iLCJhbHRSZXNwb25zZSIsImN1cnJlbmN5X2lkIiwiX2lkIiwiaWQiLCJjcnlwdG9jdXJyZW5jeV9pZCIsImFsdEVycm9yIiwiY3JlYXRlT3JHZXRDdXN0b21lciIsIm5hbWUiLCJkb2N1bWVudCIsInJlcGxhY2UiLCJjdXN0b21lciIsImN1c3RvbWVySWQiLCJjcmVhdGVEZXBvc2l0IiwiZGVwb3NpdERhdGEiLCJyZXF1ZXN0UGF5bG9hZCIsImNyeXB0b2N1cnJlbmN5IiwiY29pbkdlY2tvIiwicGl4Q29kZSIsImNvZGUiLCJwaXhfY29kZSIsImNyeXB0b0Ftb3VudCIsImNyeXB0b19hbW91bnQiLCJleHBpcmVzQXQiLCJleHBpcmVzX2F0IiwicXJDb2RlVXJsIiwicXJfY29kZV91cmwiLCJ4Z2F0ZVNlcnZpY2UiLCJnZXRYR2F0ZVNlcnZpY2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/xgate.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next@14.2.3_react-dom@18.2.0_react@18.2.0__react@18.2.0_sass@1.92.1","vendor-chunks/node_modules","vendor-chunks/jsonwebtoken@9.0.2"], () => (__webpack_exec__("(rsc)/../../node_modules/.pnpm/next@14.2.3_react-dom@18.2.0_react@18.2.0__react@18.2.0_sass@1.92.1/node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fxgate%2Fusdt%2Fcreate%2Froute&page=%2Fapi%2Fxgate%2Fusdt%2Fcreate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fxgate%2Fusdt%2Fcreate%2Froute.ts&appDir=%2FUsers%2Ffelixelmada%2FDesktop%2Fnutz-current-20250909-195539%2Fapps%2Fweb%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Ffelixelmada%2FDesktop%2Fnutz-current-20250909-195539%2Fapps%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();