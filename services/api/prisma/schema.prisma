generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model api_keys {
  id           String         @id
  name         String
  keyHash      String         @unique
  keySalt      String
  prefix       String
  scopes       String[]
  ipWhitelist  String[]
  status       ApiKeyStatus   @default(ACTIVE)
  expiresAt    DateTime?
  lastUsedAt   DateTime?
  lastUsedIp   String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  userId       String
  companyId    String
  companies    companies      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users        users          @relation(fields: [userId], references: [id], onDelete: Cascade)
  request_logs request_logs[]
}

model audit_logs {
  id         String      @id
  action     AuditAction
  resource   String?
  resourceId String?
  details    String?
  ipAddress  String?
  userAgent  String?
  requestId  String?
  createdAt  DateTime    @default(now())
  userId     String?
  companyId  String?
  companies  companies?  @relation(fields: [companyId], references: [id])
  users      users?      @relation(fields: [userId], references: [id])
}

model companies {
  id                String         @id
  name              String
  email             String
  document          String         @unique
  status            CompanyStatus  @default(PENDING_VERIFICATION)
  planId            String?
  subscriptionId    String?
  monthlyLimit      Decimal        @default(0)
  dailyLimit        Decimal        @default(0)
  requestsPerMinute Int            @default(300)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime
  api_keys          api_keys[]
  audit_logs        audit_logs[]
  plans             plans?         @relation(fields: [planId], references: [id])
  request_logs      request_logs[]
  users             users[]
  webhooks          webhooks[]
}

model investment_applications {
  id                   String           @id
  userId               String
  planId               String
  principalAmount      Decimal          @db.Decimal(18, 6)
  currentValue         Decimal          @db.Decimal(18, 6)
  accumulatedYield     Decimal          @default(0) @db.Decimal(18, 6)
  status               InvestmentStatus @default(PENDING)
  appliedAt            DateTime         @default(now())
  approvedAt           DateTime?
  maturityDate         DateTime?
  liquidatedAt         DateTime?
  acceptedTermsAt      DateTime?
  acceptedTermsIp      String?
  acceptedTermsVersion String?
  notes                String?
  metadata             String?
  createdAt            DateTime         @default(now())
  updatedAt            DateTime
  investment_plans     investment_plans @relation(fields: [planId], references: [id], onDelete: Cascade)
  users                users            @relation(fields: [userId], references: [id], onDelete: Cascade)
  yield_entries        yield_entries[]
}

model investment_plans {
  id                      String                    @id
  name                    String
  description             String?
  type                    InvestmentType
  annualYieldRate         Decimal                   @db.Decimal(5, 4)
  dailyYieldRate          Decimal                   @db.Decimal(8, 6)
  minimumAmount           Decimal                   @db.Decimal(18, 6)
  maximumAmount           Decimal?                  @db.Decimal(18, 6)
  lockPeriodDays          Int?
  hasEarlyWithdraw        Boolean                   @default(false)
  earlyWithdrawFee        Decimal?                  @db.Decimal(5, 4)
  isActive                Boolean                   @default(true)
  requiresApproval        Boolean                   @default(false)
  maxInvestors            Int?
  totalCapLimit           Decimal?                  @db.Decimal(18, 6)
  termsAndConditions      String?
  riskDisclosure          String?
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  investment_applications investment_applications[]
}

model investment_transactions {
  id                 String                    @id
  walletId           String
  applicationId      String?
  type               InvestmentTransactionType
  status             TransactionStatus         @default(PENDING)
  amount             Decimal                   @db.Decimal(18, 6)
  balanceAfter       Decimal?                  @db.Decimal(18, 6)
  planId             String?
  planName           String?
  yieldRate          Decimal?                  @db.Decimal(8, 6)
  description        String?
  metadata           String?
  processedAt        DateTime?
  createdAt          DateTime                  @default(now())
  updatedAt          DateTime
  investment_wallets investment_wallets        @relation(fields: [walletId], references: [id], onDelete: Cascade)
}

model investment_wallets {
  id                      String                    @id
  userId                  String                    @unique
  totalInvested           Decimal                   @default(0) @db.Decimal(18, 6)
  currentValue            Decimal                   @default(0) @db.Decimal(18, 6)
  totalReturns            Decimal                   @default(0) @db.Decimal(18, 6)
  totalWithdrawn          Decimal                   @default(0) @db.Decimal(18, 6)
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  investment_transactions investment_transactions[]
  users                   users                     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model offers {
  id        String        @id
  title     String
  subtitle  String?
  ctaText   String?
  imagePath String
  targetUrl String
  audience  OfferAudience @default(SELLER)
  isActive  Boolean       @default(true)
  startsAt  DateTime?
  endsAt    DateTime?
  sortOrder Int           @default(0)
  createdAt DateTime      @default(now())
  updatedAt DateTime
  deletedAt DateTime?
  createdBy String
  users     users         @relation(fields: [createdBy], references: [id])
}

model pix_transactions {
  id           String             @id
  walletId     String
  type         PIXTransactionType
  status       TransactionStatus  @default(PENDING)
  amount       Decimal            @db.Decimal(10, 2)
  balanceAfter Decimal?           @db.Decimal(10, 2)
  pixKey       String?
  endToEndId   String?
  pixCode      String?
  externalId   String?
  description  String?
  metadata     String?
  processedAt  DateTime?
  createdAt    DateTime           @default(now())
  updatedAt    DateTime
  pix_wallets  pix_wallets        @relation(fields: [walletId], references: [id], onDelete: Cascade)
}

model pix_wallets {
  id               String             @id
  userId           String             @unique
  balance          Decimal            @default(0) @db.Decimal(10, 2)
  totalDeposited   Decimal            @default(0) @db.Decimal(10, 2)
  totalWithdrawn   Decimal            @default(0) @db.Decimal(10, 2)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  pix_transactions pix_transactions[]
  users            users              @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model plans {
  id                String      @id
  name              String
  description       String?
  monthlyFee        Decimal
  transactionFee    Decimal
  monthlyLimit      Decimal
  dailyLimit        Decimal
  requestsPerMinute Int         @default(300)
  featuresJson      String
  active            Boolean     @default(true)
  createdAt         DateTime    @default(now())
  updatedAt         DateTime
  companies         companies[]
}

model rate_limit_records {
  id           String   @id
  identifier   String
  windowStart  DateTime
  requestCount Int      @default(1)
  createdAt    DateTime @default(now())
  updatedAt    DateTime

  @@unique([identifier, windowStart])
}

model request_logs {
  id           String     @id
  requestId    String     @unique
  method       String
  path         String
  statusCode   Int
  responseTime Int
  ipAddress    String
  userAgent    String?
  createdAt    DateTime   @default(now())
  apiKeyId     String?
  companyId    String?
  api_keys     api_keys?  @relation(fields: [apiKeyId], references: [id])
  companies    companies? @relation(fields: [companyId], references: [id])
}

model sessions {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expiresAt    DateTime
  createdAt    DateTime @default(now())
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model stark_bank_events {
  id          String    @id
  eventId     String    @unique
  eventType   String
  resource    String
  payload     String
  processed   Boolean   @default(false)
  processedAt DateTime?
  error       String?
  createdAt   DateTime  @default(now())
}

model starkbank_configs {
  id          String               @id
  projectId   String               @unique
  privateKey  String
  publicKey   String
  environment StarkbankEnvironment @default(SANDBOX)
  isActive    Boolean              @default(true)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime
}

model usdt_transactions {
  id               String            @id
  walletId         String
  type             TransactionType
  status           TransactionStatus @default(PENDING)
  amount           Decimal           @db.Decimal(18, 6)
  balanceAfter     Decimal?          @db.Decimal(18, 6)
  pixCode          String?
  pixTransactionId String?
  brlAmount        Decimal?          @db.Decimal(10, 2)
  exchangeRate     Decimal?          @db.Decimal(10, 6)
  description      String?
  externalId       String?
  metadata         String?
  processedAt      DateTime?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime
  usdt_wallets     usdt_wallets      @relation(fields: [walletId], references: [id], onDelete: Cascade)
}

model usdt_wallets {
  id                String              @id
  userId            String              @unique
  balance           Decimal             @default(0) @db.Decimal(18, 6)
  frozenBalance     Decimal             @default(0) @db.Decimal(18, 6)
  totalDeposited    Decimal             @default(0) @db.Decimal(18, 6)
  totalWithdrawn    Decimal             @default(0) @db.Decimal(18, 6)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  usdt_transactions usdt_transactions[]
  users             users               @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model users {
  id                       String                    @id
  email                    String                    @unique
  name                     String
  password                 String
  role                     UserRole                  @default(MEMBER)
  status                   UserStatus                @default(PENDING)
  accountType              AccountType?
  companyName              String?
  document                 String?
  emailVerified            Boolean                   @default(false)
  emailVerifiedAt          DateTime?
  twoFactorEnabled         Boolean                   @default(false)
  twoFactorSecret          String?
  lastLoginAt              DateTime?
  lastLoginIp              String?
  exchangeRateFeePercent   Decimal?                  @default(0) @db.Decimal(5, 4)
  exchangeRateFeeFixed     Decimal?                  @default(0) @db.Decimal(10, 2)
  pixPayinFeePercent       Decimal?                  @default(0) @db.Decimal(5, 4)
  pixPayinFeeFixed         Decimal?                  @default(0) @db.Decimal(10, 2)
  pixPayoutFeePercent      Decimal?                  @default(0) @db.Decimal(5, 4)
  pixPayoutFeeFixed        Decimal?                  @default(0) @db.Decimal(10, 2)
  manualWithdrawFeePercent Decimal?                  @default(0) @db.Decimal(5, 4)
  manualWithdrawFeeFixed   Decimal?                  @default(0) @db.Decimal(10, 2)
  usdtPurchaseFeePercent   Decimal?                  @default(0) @db.Decimal(5, 4)
  usdtPurchaseFeeFixed     Decimal?                  @default(0) @db.Decimal(10, 2)
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime
  companyId                String?
  api_keys                 api_keys[]
  audit_logs               audit_logs[]
  investment_applications  investment_applications[]
  investment_wallets       investment_wallets?
  offers                   offers[]
  pix_wallets              pix_wallets?
  sessions                 sessions[]
  usdt_wallets             usdt_wallets?
  companies                companies?                @relation(fields: [companyId], references: [id])
}

model webhook_deliveries {
  id             String    @id
  webhookId      String
  eventType      String
  payload        String
  signature      String
  responseStatus Int?
  responseBody   String?
  deliveredAt    DateTime?
  createdAt      DateTime  @default(now())
  webhooks       webhooks  @relation(fields: [webhookId], references: [id], onDelete: Cascade)
}

model webhooks {
  id                 String               @id
  url                String
  secret             String
  events             String[]
  status             WebhookStatus        @default(ACTIVE)
  retryCount         Int                  @default(0)
  maxRetries         Int                  @default(3)
  lastTriggeredAt    DateTime?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  companyId          String
  webhook_deliveries webhook_deliveries[]
  companies          companies            @relation(fields: [companyId], references: [id], onDelete: Cascade)
}

model yield_entries {
  id                      String                  @id
  applicationId           String
  baseAmount              Decimal                 @db.Decimal(18, 6)
  yieldRate               Decimal                 @db.Decimal(8, 6)
  yieldAmount             Decimal                 @db.Decimal(18, 6)
  referenceDate           DateTime
  calculatedAt            DateTime                @default(now())
  isPaid                  Boolean                 @default(false)
  paidAt                  DateTime?
  transactionId           String?
  createdAt               DateTime                @default(now())
  investment_applications investment_applications @relation(fields: [applicationId], references: [id], onDelete: Cascade)
}

enum AccountType {
  PF
  PJ
}

enum ApiKeyStatus {
  ACTIVE
  REVOKED
  EXPIRED
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
  API_KEY_GENERATE
  API_KEY_REVOKE
  API_KEY_ROTATE
  WEBHOOK_CREATE
  WEBHOOK_UPDATE
  WEBHOOK_DELETE
  STARKBANK_CONFIG_UPDATE
}

enum CompanyStatus {
  ACTIVE
  SUSPENDED
  PENDING_VERIFICATION
  BLOCKED
}

enum InvestmentStatus {
  ACTIVE
  PENDING
  CANCELLED
  MATURED
  LIQUIDATED
}

enum InvestmentTransactionType {
  INVESTMENT
  YIELD
  WITHDRAWAL
  ADJUSTMENT
}

enum InvestmentType {
  FIXED_INCOME
  LIQUIDITY
  PREMIUM
}

enum OfferAudience {
  SELLER
  BUYER
  ALL
}

enum PIXTransactionType {
  DEPOSIT
  WITHDRAWAL
  TRANSFER_IN
  TRANSFER_OUT
  ADJUSTMENT
}

enum StarkbankEnvironment {
  SANDBOX
  PRODUCTION
}

enum TransactionStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
  EXPIRED
}

enum TransactionType {
  DEPOSIT
  WITHDRAWAL
  INVESTMENT
  RETURN
  TRANSFER_IN
  TRANSFER_OUT
  ADJUSTMENT
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  OWNER
  MEMBER
}

enum UserStatus {
  ACTIVE
  SUSPENDED
  PENDING
}

enum WebhookStatus {
  ACTIVE
  INACTIVE
  FAILED
}
